{% extends 'base.html' %}

{% load app_filters %}

{% load static %}

{% block page_title %} Case Events {% endblock %}

{% block style_code %}
<link href="{% static 'css/jquery.fileupload.css' %}" rel="stylesheet" />
<link href="{% static 'css/bootstrap-table.min.css' %}" rel="stylesheet" />
<link href="{% static 'plugins/bootstrap-multiselect/dist/css/bootstrap-multiselect.css' %}" rel="stylesheet">
<link href="{% static 'plugins/bootstrap-wizard/css/bwizard.min.css' %}" rel="stylesheet" />
<link href="{% static 'plugins/bootstrap-datepicker/css/datepicker3.css' %}" rel="stylesheet" />
<style type="text/css">
.dialog_paragraph {
  color: #f00;
}

.table_data {
  display: none;
}

.container {
    width: 100%;
    overflow-x: auto;
}

.td_style {
  color: #0057e7;
}
</style>
{% endblock %}

{% block javascript_code%}
{% endblock javascript_code%}

{% block primary %}
<!-- begin breadcrumb -->
<ol class="breadcrumb pull-right">
    <li><a href="#">Home</a></li>
    <li clasbootstrap-tas="active">Case Events</li>
</ol>
<!-- end breadcrumb -->

{% if messages %}
<div id="messages" class="alert alert-success fade in">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-check fa-2x pull-left"></i>
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.info %} class="{{ message.info }}"{% endif %}><b>{{ message }}</b></li>
        {% endfor %}
    </ul>
</div>
{% endif %}


<!-- #closure-warning-dialog -->
<div class="modal fade" id="closure-warning-dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h4 class="modal-title">
                <div id="closure-warning-dialog-header">
                    <p>Warning</p>      
                </div>
                </h4>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger m-b-0">
                    <h4><i class="fa fa-info-circle"></i> <small><span id="span_closure_alert"></span></small></h4>                    
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-sm btn-white" data-dismiss="modal">Close</a>
            </div>
        </div>
    </div>
</div>
<!-- #end-closure-warning-dialog -->


<div id="ce_msgs" class="alert alert-success fade in" style="display:none;">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-check fa-2x pull-left"></i>
    <ul class="messages">
       <p></p>
    </ul>
</div>

<div id="error_msgs" class="alert alert-danger fade in" style="display:none;">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-close fa-2x pull-left"></i>
    <ul class="messages">
       <p></p>
    </ul>
</div>

<!-- begin page-header -->
<div class="profile-section">
    <!-- begin row -->
    <div class="row">
        <!-- begin col-4 -->
        <div class="col-md-4">
            <h4 class="title"><small>About Child</small></h4>
            {% for data in init_data %}
                <h1 class="page-header">Forms <small>Manage Case Events <b>{{ data.first_name }} {{ data.surname }} | {{ data.sex_id|gen_value:vals }} | {% if data.date_of_birth|gen_age == 0 %}
                            UNDER 1 YEAR
                        {% else %}
                            {{ data.date_of_birth|gen_age }} YRS 
                        {% endif %}</b></small></h1>

                <!--
                <h6>NAME : <i> {{ data.first_name }} {{ data.surname }}</i></h6>
                <h6>SEX : <i> {{ data.sex_id|gen_value:vals }}</i></h6>
                <h6>DATE OF BIRTH : <i> {{ data.date_of_birth }}</i></h6>
                <h6>
                AGE IN YEARS :
                    <i>
                        {% if data.date_of_birth|gen_age == 0 %}
                            UNDER 1 YEAR
                        {% else %}
                            {{ data.date_of_birth|gen_age }} YRS 
                        {% endif %}
                     </i>
                </h6>
                -->
            {% endfor %}
        </div>
    </div>
</div>
<!-- end page-header -->

<div id="messages" class="alert alert-danger fade in" style="display: none;" tabindex="1">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-check fa-2x pull-left"></i>
    <p class="invalid-form-message"></p>
</div>


<br><br>
<div>
    <div id="case_status_msg" align="right">
    <small>
        <button class="btn  btn-sm btn-primary active m-r-5" onClick="fnNavigateBack()">  
        <i class="fa fa-arrow-left"></i>&nbsp; <b>BACK TO FOLLOW-UPS </b>                       
        </button>
    </small>
    {% for resultset in  resultsets %}
        {% for result in  resultset %}
            {% for res in result.c_record %}

                {% if result.c_close %}
                    {% for res2 in result.c_close %}                    
                        <small>
                            <button id="btn_case_status" class="btn  btn-sm btn-danger active m-r-5" onClick="fnOpenDialog('CaseStatus')">
                            {% if res2.transfer_to_id %}
                                <b>{{ res.case_status }} TO {{ res2.transfer_to_id|gen_orgunitname }}</b>
                            {% else %}
                                <b>{{ res.case_status }}</b>
                            {% endif %}                            
                            </button>
                        </small>
                    {% endfor %}
                {% else %}
                <small>
                    <button id="btn_case_status" class="btn  btn-sm btn-danger active m-r-5" onClick="fnOpenDialog('CaseStatus')">
                        <b>{{ res.case_status }}</b>      
                    </button>
                </small>
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% endfor %}
    </div>
<div>

<!-- Case Summary -->
    <div class="profile-section">
        <!-- begin row -->
        <div class="row">
            <!-- begin col-4 -->
            <div id="div_case_summary" class="col-md-12">
                <h4 class="title">Case Summary <small>Database Information</small></h4>
                <!-- begin scrollbar -->
                <div data-scrollbar="true" data-height="150px" class="bg-silver">
                    <table class="table">
                        <thead>                                
                            <th>Case Serial</th>
                            <th>Case Category(s) | Date Of Event</th>
                            <th>Referrals</th>
                        </thead>
                        <tbody>
                        {% for resultset in  resultsets %}
                            {% for result in  resultset %}
                            <tr>
                            {% for res in result.c_record %} 
                                <td>{{ res.case_serial }}</td>
                            {% endfor %}
                            <td>
                                <ol>
                                {% for res in result.c_cats %}                             
                                    <li>
                                    {{ res.case_category|gen_value:vals }} | {{ res.date_of_event }} <br>
                                    </li>                                
                                {% endfor %}
                                </ol>
                            </td>
                            <td>
                                {% if result.c_refs %}
                                    <ol>
                                    {% for res in result.c_refs %}                             
                                        <li>
                                        {{ res.refferal_to|gen_value:vals }} <br>
                                        </li>                                
                                    {% endfor %}
                                    </ol>
                                {% else %}
                                    No referrals to show
                                {% endif %}
                            </td>                            
                            
                            </tr>
                            {% endfor %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- end scrollbar -->
            </div>
        </div>
    </div>
    <!-- End Case Summary -->
        <br><br>
    <!-- OVC Case Record Row -->
    <div class="row">
            <!-- begin col-12 -->
            <div class="col-md-12">
                    <!-- begin panel -->
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <div class="panel-heading-btn">
                                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                            </div>                          
                            <h4 class="panel-title"><b>Case Events List </b></h4>                    
                        </div>

                       
                        <!-- begin panel -->
                        <div class="panel-body">
                            <div  class="panel panel-inverse">
                                <div id="case-events"  class="table-responsive">
                                    <table id="case_events_data_table" class="table table-striped table-bordered">
                                    <thead>
                                        <tr> 
                                            <th>Event Type</th>
                                            <th>Case Category</th>                                            
                                            <th>Details</th> 
                                            <th>Date Of Event</th>                
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                    </table>
                                </div>
                                <br><br>                           
                            </div>
                        </div>
                        <!-- end panel -->
                    </div>

                     <!-- Case ID -->
                    <div>
                        {{ form.case_id }}
                        {{ form.operation_mode }}
                        {{ form.case_event_id }}
                        {{ form.case_event_type }}
                    </div>

                    <!-- #delete-dialog -->
                    <div class="modal fade" id="delete-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">Confirm Delete</h4>
                                </div>
                                <div id ="div-delete-doalog" class="modal-body">
                                    <p></p>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-sm btn-white" data-dismiss="modal">No</button>
                                    <button class="btn btn-sm btn-success" 
                                        onClick="deleteCaseEvent_()">Yes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #delete-dialog -->

                    <!-- #services-dialog -->
                    <div class="modal fade" id="services-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h4 class="modal-title">
                                    <div id="services-dialog-header">
                                        <p>Manage Encounters / Services &nbsp;&nbsp;<i class="fa fa-gears"></i></p>      
                                    </div>
                                    </h4>
                                </div>
                                <div class="modal-body">

                                    <div id="encounters_msgs" class="alert alert-danger fade in" style="display:none;">
                                        <span class="close" data-dismiss="alert">×</span>
                                        <i class="fa fa-close fa-2x pull-left"></i>
                                        <ul class="messages">
                                           <small><p></p></small>
                                        </ul>
                                    </div>

                                    <div class="row">
                                        {{ form.case_event_id_svc }}   
                                        <div class="form-group">
                                            <h6><label class="control-label col-md-3 col-sm-3">Case Category:<span class="asteriskField"> *</span></label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.service_provided_case }}
                                                    <div id="encounters_msgs0" style="display:none;">
                                                        <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>                                       
                                        <br><br>
                                        <div class="form-group">
                                             <div id="encounters_msgs1" style="display:none;">
                                                <small><span><p class="dialog_paragraph">One or more service(s) is required</p></span></small>
                                            </div>
                                             <table id="services_manager_table" class="table">
                                                <thead>
                                                    <tr id="id_inputHeaders">                                                        
                                                        <th><h6><b>#</b></h6></th>
                                                        <th width="30%"><h6><b>Service(s)</b></h6></th>
                                                        <th width="20%"><h6><b>Date Of Service</b></h6></th>
                                                        <th width="20%"><h6><b>Service(s) Provider</b></h6></th>
                                                        <th width="20%"><h6><b>Place Of Service</b></h6></th>
                                                        <th width="5%"><h6><b>Actions</b></h6></th> 

                                                    </tr>
                                                </thead>
                                                <div>
                                                <tbody>
                                                    <tr id="id_inputElements">
                                                        <td>#</td>
                                                        <td width="30%">
                                                        {{ form.service_provided }}
                                                        <h6><span id="sel_service_provided"></span></h6>
                                                        <div id="service_provided_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td width="10%">
                                                        {{ form.date_of_encounter_event }}
                                                        <div id="date_of_encounter_event_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td width="30%">
                                                        {{ form.service_provider }}
                                                        <div id="service_provider_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td width="20%">
                                                        {{ form.place_of_service }}
                                                        <div id="place_of_service_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td  width="5%">
                                                        <button type="button" class="btn btn-sm btn-inverse m-r-5" onClick="AddRow(2)">
                                                            <i class="fa fa-plus"></i>&nbsp; <b>Add Service(s)</b>
                                                        </button>
                                                        </td>
                                                    <tr>
                                                </tbody>
                                            </table>
                                            {{ form.service_provided_list }}
                                        </div>
                                        <br><br>
                                        <div class="form-group">
                                            <h6><label class="control-label col-md-3 col-sm-3">Encounter/Service Notes :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.encounter_notes }}
                                                    <div id="encounters_msgs2" style="display:none;">
                                                        <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>  
                                        <br><br>
                                    </div>
                                    
                                </div>
                                <div class="modal-footer" >
                                    <button class="btn btn-sm btn-white" data-dismiss="modal">Cancel</button>
                                    <button id="btn_save_encounter" class="btn btn-sm btn-success" onClick="fnSaveEncounter()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #end services-dialog -->

                    <!-- #court-sessions-dialog -->
                    <div class="modal fade" id="court-sessions-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">
                                    <div id="court-sessions-dialog">
                                        <p>Manage Court Session &nbsp;&nbsp;<i class="fa fa-legal"></i></p>      
                                    </div>
                                    </h4>
                                </div>
                                <div class="modal-body">

                                    <div id="court_msgs" class="alert alert-danger fade in" style="display:none;">
                                        <span class="close" data-dismiss="alert">×</span>
                                        <i class="fa fa-close fa-2x pull-left"></i>
                                        <ul class="messages">
                                            <small><p></p></small>
                                        </ul>
                                    </div>

                                    <div class="row">

                                        {{ form.case_event_id_court }}

                                        <div class="row">
                                            <h6><label class="control-label col-md-3 col-sm-3">Case Category <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                {{ form.court_session_case }}
                                                <div id="court_msgs0" style="display:none;">
                                                     <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <h6><label class="control-label col-md-3 col-sm-3">Date Of Court Session <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.date_of_court_event }}
                                                    <div id="court_msgs1" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <h6><label class="control-label col-md-3 col-sm-3">Court Session Type <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.court_session_type }}
                                                    <div id="court_msgs2" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_plea_taken" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Plea Taken <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.plea_taken }}
                                                    <div id="court_msgs8" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_next_mention_date" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Date of Next Mention <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.next_mention_date }}
                                                    <div id="court_msgs3" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_application_outcome" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Application Outcome : <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.application_outcome }}
                                                    <div id="court_msgs9" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_court_outcome" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Court Outcome <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6 form-group block1">
                                                {{ form.court_outcome }}
                                                <div id="court_msgs4" style="display:none;">
                                                     <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_next_hearing_date" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Date of Next Hearing <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                {{ form.next_hearing_date }}
                                                <div id="court_msgs5" style="display:none;">
                                                     <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_court_order" style="display:none;">
                                            <h6><label class="control-label col-md-3 col-sm-3">Court Order(s) <span class="asteriskField">*</span> :</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                {{ form.court_order }}
                                                <div id="court_msgs6" style="display:none;">
                                                     <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                </div>
                                                <h6><span id="sel_court_order"></span></h6>
                                                <br>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <h6><label class="control-label col-md-3 col-sm-3">Court Session Notes:</label></h6>
                                            <div class="col-md-6 col-sm-6">
                                                    {{ form.court_notes }}
                                                    <div id="court_msgs7" style="display:none;">
                                                         <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                                    </div>
                                            </div>
                                        </div> 
                                    </div>
                                </div>
                                <div class="modal-footer" >
                                    <button class="btn btn-sm btn-white" data-dismiss="modal">Cancel</button>
                                    <button id="btn_save_court" class="btn btn-sm btn-success" onClick="fnSaveCourtSession()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #end court-sessions-dialog -->

                    <!-- #summons-dialog -->
                    <div class="modal fade" id="summons-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">
                                    <div id="summons-dialog">
                                        <p>Manage Summons &nbsp;&nbsp;<i class="fa fa-wechat"></i></p>
                                    </div>
                                    </h4>
                                </div>
                                <div class="modal-body">

                                    <div id="summon_msgs" class="alert alert-danger fade in" style="display:none;">
                                        <span class="close" data-dismiss="alert">×</span>
                                        <i class="fa fa-close fa-2x pull-left"></i>
                                        <ul class="messages">
                                            <small><p></p></small>
                                        </ul>
                                    </div>
                                <!--
                                <div class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Total Number Of Summons :</label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        <h6><b> 0 </b></h6>
                                    </div>
                                </div>
                                <br><br>
                                -->
                                {{ form.case_event_id_summon }}

                                {{ form.reported_date }}

                                <div class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Summon Count: </label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        <b>{{ summon_count }}</b><span id="summon_count" style="display:none;">{{ summon_count }}</span>
                                    </div>
                                </div>

                                <!--
                                <br><br>
                                <div class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Date Of Visit:<span class="asteriskField"> *</span></label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        {{ form.visit_date }}
                                        <div id="summons_msgs5" style="display:none;">
                                            <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                        </div>
                                    </div>
                                </div>
                                -->
                                <br><br> 
                                <div id="div_honoured_date" class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Date Of Visit:<span class="asteriskField"> *</span></label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        {{ form.honoured_date }}
                                        <div id="summons_msgs2" style="display:none;">
                                            <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                        </div>
                                    </div>
                                </div>
                                <br><br>                                 
                                <div class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Summon Honored ? :<span class="asteriskField"> *</span></label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        {{ form.honoured }}
                                        <div id="summons_msgs1" style="display:none;">
                                            <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                        </div>
                                    </div>
                                </div>
                                <br><br>                                                               
                                <div id="div_summon_date" style="display:none;" class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Date Of Next Summon:<span class="asteriskField"> *</span></label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        {{ form.summon_date }}
                                        <div id="summons_msgs3" style="display:none;">
                                            <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                        </div>
                                    </div>
                                </div>                                
                                <br><br>
                                <div class="form-group">
                                    <h6><label class="control-label col-md-4 col-sm-4">Notes :<span class="asteriskField"> *</span></label></h6>
                                    <div class="col-md-6 col-sm-6">
                                        {{ form.summon_note }}
                                        <div id="summons_msgs4" style="display:none;">
                                            <small><span><p class="dialog_paragraph">This value is required</p></span></small>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <br><br><br><br>
                                <div class="modal-footer" >
                                    <button class="btn btn-sm btn-white" data-dismiss="modal">Cancel</button>
                                    <button id="btn_save_summon" class="btn btn-sm btn-success" onClick="fnSaveSummons()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #end summons-dialog -->

                    <!-- #case-status-dialog -->
                    <div class="modal fade" id="case-status-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">
                                    <div id="case-status-dialog">
                                        <p>Manage Case Status &nbsp;&nbsp;<i class="fa fa-tachometer"></i></p>
                                    </div>
                                    </h4>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">                                                
                                        <div>
                                            <h6><span id="span_case_status"></span></h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #end case-status-dialog -->


                    <!-- #manage-referals-dialog -->
                    <div class="modal fade" id="manage-referals-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">Create New Referrals</h4>
                                </div>
                                <div class="modal-body">
                                    <div id="referral_event_msgs" class="alert alert-danger fade in" style="display:none;">
                                        <span class="close" data-dismiss="alert">×</span>
                                        <i class="fa fa-close fa-2x pull-left"></i>
                                        <ul class="messages">
                                           <h6><p></p></h6>
                                        </ul>
                                    </div>

                                    <div class="row">
                                        <table id="new_refferals_table" class="table table-striped table-bordered">
                                            <thead>
                                                <th width="2%"><h6><b>#</b></h6></th>
                                                <th width="15%"><h6><b>Case Category</b></h6></th>
                                                <th width="15%"><h6><b>Referral Actor</b></th>
                                                <th width="20%"><h6><b>Specify</b></th>
                                                <th width="30%"><h6><b>Referral For</b></th>
                                                <th width="5%"><h6><b>Actions</b></th>
                                            </thead>
                                            <tbody>
                                                <td width="2%">#</td>
                                                <td width="30%">
                                                {{ form.refferal_case }}
                                                <h6><span id="sel_refferal_case"></span></h6>
                                                <div id="refferal_case_errormsg" style="display:none;">
                                                    <h6><span><p class="dialog_paragraph">This value is required</p></span></h6>
                                                </div>
                                                </td>

                                                <td width="20%">
                                                {{ form.refferals_actor }}
                                                <h6><span id="sel_refferals_actor"></span></h6>
                                                <div id="refferals_actor_errormsg" style="display:none;">
                                                    <h6><span><p class="dialog_paragraph">This value is required</p></span></h6>
                                                </div>
                                                </td>

                                                <td width="20%">
                                                {{ form.refferals_actor_specify }}
                                                <h6><span id="sel_refferals_actor_specify"></span></h6>
                                                <div id="refferals_actor_specify_errormsg" style="display:none;">
                                                    <h6><span><p class="dialog_paragraph">This value is required</p></span></h6>
                                                </div>
                                                </td>

                                                <td width="30%">
                                                {{ form.refferals_made }}
                                                <h6><span id="sel_refferals_made"></span></h6>
                                                <div id="refferals_made_errormsg" style="display:none;">
                                                    <h6><span><p class="dialog_paragraph">This value is required</p></span></h6>
                                                </div>
                                                </td>

                                                <td width="3%">
                                                <button type="button" class="btn btn-sm btn-inverse m-r-5" onClick="AddRow(1)">
                                                    <i class="fa fa-plus"></i>&nbsp; <b>Save</b>
                                                </button>
                                                </td>                                                                        
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div class="row" id="div_referrals">
                                        <legend class="pull-left width-full"><h4 class="modal-title">Manage Previous Referrals</h4></legend>
                                        <!--
                                        <div>
                                            <button type="button" class="btn btn-sm btn-white m-r-5" onClick="LoadReferrals()">
                                                <i class="fa fa-refresh"></i>&nbsp; <b>Load Data / Refresh</b>
                                            </button>
                                        </div>
                                        <br>
                                        -->
                                        <div id="referral_msgs" class="alert alert-success fade in" style="display:none;">
                                            <span class="close" data-dismiss="alert">×</span>
                                            <i class="fa fa-check fa-2x pull-left"></i>
                                            <ul class="messages">
                                               <h6><p></p></h6>
                                            </ul>
                                        </div>
                                        <br>  
                                        <div class="container" style="overflow-y: scroll; height:250px;">                                   
                                        <table id="old_refferals_table" class="table table-striped table-bordered">
                                            <thead>
                                                <!-- Dynamically Created Using Json Object -->
                                            </thead>                                            
                                            <tbody>
                                                <!-- Dynamically Created Using Json Object -->
                                            </tbody>                                            
                                        </table>
                                        </div>
                                    </div>
                                    
                                    
                                </div>
                                <div class="modal-footer" >
                                    <button class="btn btn-sm btn-white" data-dismiss="modal">Close</button>
                                    <!-- <button class="btn btn-sm btn-success" onClick="fnManageReferral()">Save</button> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- #end manage-referals-dialog -->

                    <!-- #close-case-dialog -->
                    <div class="modal fade" id="close-case-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title">Case Closure
                                    &nbsp;&nbsp;<i class="fa fa-close"></i></h4>
                                </div>
                                <div class="modal-body">
                                    <div id="closure_msgs" class="alert alert-danger fade in" style="display:none;">
                                        <span class="close" data-dismiss="alert">×</span>
                                        <i class="fa fa-close fa-2x pull-left"></i>
                                        <ul class="messages">
                                           <p></p>
                                        </ul>
                                    </div>

                                    <br>
                                        <!--
                                        <div class="form-group">
                                            <h6><label class="control-label col-md-4 col-sm-4">Close Case? :<span class="asteriskField"> *</span></label></h6>
                                            <div class="col-md-7 col-sm-7">
                                                    {{ form.case_status }}
                                                    <div id="closure_msgs1" style="display:none;">
                                                        <span><p class="dialog_paragraph">This value is required</p></span>
                                                    </div>
                                            </div>
                                        </div>
                                        <br><br>
                                        -->
                                        {{ form.case_event_id_closure }}

                                        <div class="row">
                                            <h6><label class="control-label col-md-4 col-sm-4">Case Outcome :<span class="asteriskField"> *</span></label></h6>
                                            <div class="col-md-7 col-sm-7">
                                                    {{ form.case_outcome }}
                                                    <div id="closure_msgs2" style="display:none;">
                                                        <span><p class="dialog_paragraph">This value is required</p></span>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_transfered_to" style="display:none;">
                                            <h6><label class="control-label col-md-4 col-sm-4">Transferred To :<span class="asteriskField"> *</span></label></h6>
                                            <div class="col-md-7 col-sm-7">
                                                    {{ form.transfered_to }}
                                                    <div id="closure_msgs3" style="display:none;">
                                                        <span><p class="dialog_paragraph">This value is required</p></span>
                                                    </div>
                                            </div>
                                        </div>

                                        <div class="row" id="div_intervention">
                                            <br>
                                            <div id="closure_msgs6" style="display:none;">
                                                <small><span><p class="dialog_paragraph">One or more intervention(s) is required</p></span></small>
                                            </div>
                                            <table id="interventions_manager_table" class="table">
                                                <thead>
                                                    <tr id="id_inputHeaders">                                                        
                                                        <th width="5%"><h6><b>#</b></h6></th>
                                                        <th width="30%"><h6><b>Case Category</b></h6></th>
                                                        <th width="40%"><h6><b>Intervention(s)</b></h6></th>
                                                        <th width="10%"><h6><b>Actions</b></h6></th> 
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr id="id_inputElements">
                                                        <td width="5%"></td>
                                                        <td width="30%">
                                                        {{ form.case_closure_case }}
                                                        <div id="case_closure_case_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td width="40%">
                                                        {{ form.intervention }}
                                                        <div id="intervention_errormsg" style="display:none;">
                                                            <small><p class="dialog_paragraph">This value is required</p></span></small><span>
                                                        </div>
                                                        </td>

                                                        <td  width="10%">
                                                        <button type="button" class="btn btn-sm btn-inverse m-r-5" onClick="AddRow(3)">
                                                            <i class="fa fa-plus"></i>&nbsp; <b>Add Intervention(s)</b>
                                                        </button>
                                                        </td>
                                                    <tr>
                                                </tbody>
                                            </table>
                                            {{ form.intervention_list }}
                                            <br>
                                        </div>

                                        <div class="row">
                                            <h6><label class="control-label col-md-4 col-sm-4">Date Of Outcome :<span class="asteriskField"> *</span></label></h6>
                                            <div class="col-md-7 col-sm-7">
                                                    {{ form.date_of_case_closure }}
                                                    <div id="closure_msgs4" style="display:none;">
                                                        <span><p class="dialog_paragraph">This value is required</p></span>
                                                    </div>
                                            </div>                                            
                                        </div>

                                        <div class="row">
                                            <h6><label class="control-label col-md-4 col-sm-4">Case Closure Notes :</label></h6>
                                            <div class="col-md-7 col-sm-7">
                                                    {{ form.case_closure_notes }}
                                                    <div id="closure_msgs5" style="display:none;">
                                                        <span><p class="dialog_paragraph">This value is required</p></span>
                                                    </div>
                                            </div>                                            
                                        </div>

                                        <br><br>
                                                                          
                                    <div class="modal-footer" >
                                        <button class="btn btn-sm btn-white" data-dismiss="modal">Cancel</button>
                                        <button id="btn_save_closure" class="btn btn-sm btn-success" onClick="fnSaveClosure()">Save</button>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <!-- #end close-case-dialog -->
                </div>
            </div>
            <!-- End OVC Results Row -->  

        <br>
        <!--<div class="row" align="center"> -->
        <div align="center">
            <!--
            <a href="#services-dialog" class="btn  btn-sm btn-inverse m-r-5"  data-toggle="modal">
                <b>Add Encounter / Services</b>&nbsp;&nbsp;<i class="fa fa-gears"></i>
            </a>
            -->
            <button class="btn  btn-sm btn-inverse m-r-5" onClick="fnOpenDialog('Services')">
                <b>Manage Encounter / Services</b>&nbsp;&nbsp;<i class="fa fa-gears"></i>
            </button>
            <button class="btn  btn-sm btn-inverse m-r-5" onClick="fnOpenDialog('Court')">
                <b>Manage Court Session</b>&nbsp;&nbsp;<i class="fa fa-legal"></i>
            </button>
             <button class="btn  btn-sm btn-inverse m-r-5" onClick="fnOpenDialog('Summon')">
                <b>Manage Summons</b>&nbsp;&nbsp;<i class="fa fa-wechat"></i>
            </button>
            <button class="btn  btn-sm btn-inverse m-r-5" onClick="fnOpenDialog('Referral')">
                <b>Manage Referals</b>&nbsp;&nbsp;<i class="fa fa-share"></i>
            </button>
            <button href="#close-case-dialog" class="btn  btn-sm btn-inverse m-r-5" onClick="fnOpenDialog('Closure')">
                <b>Close Case</b>&nbsp;&nbsp;<i class="fa fa-close"></i>
            </button>

        </div>

        <br><br>
    </div>
  </div>
</div>
<!-- End Search Row -->



<!-- End content area -->
{% endblock %}

{% block lazy_javascript_code %}
<script src="/static/plugins/parsley/dist/parsley.js"></script>
<script src="{% static 'js/bootstrap-table.min.js' %}"></script>
<script src="{% static 'js/bootstrap-table-locale-all.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap-multiselect/dist/js/bootstrap-multiselect.js' %}"></script>
<script src="{% static 'js/form-wizards.js' %}"></script>
<script type="text/javascript">
function ResetEventsDialog(event_type)
{
    // clear operation_mode
    $('#operation_mode').val('');

    if(event_type == 'Services')
    {
        // Reset All Controls/Table
        $('#service_provided_case').multiselect("clearSelection"); 
        $('#service_provided_case').multiselect("refresh"); 
        $('#date_of_encounter_event').val(''); 
        $('#service_provided_list').val(''); 
        $('#encounter_notes').val(''); 
        $("#service_provided").multiselect("clearSelection");
        $("#service_provided").multiselect("refresh");
        $("#sel_service_provided").html('');
        $("#sel_service_provider").html('');
        $("#services_manager_table").find("tr:gt(1)").remove();
        $("#encounters_msgs").css({ 'display': 'none'})
        $("#btn_save_encounter").text('Save');
    }
    if(event_type == 'Court')
    {
        // Reset All Controls
        $("#court_session_case").multiselect("clearSelection");
        $("#court_session_case").multiselect("refresh");
        $('#date_of_court_event').val('');
        $("#court_session_type").multiselect("clearSelection");
        $("#court_session_type").multiselect("refresh");
        $("#court_session_type").trigger("change"); 
        $("#court_outcome").multiselect("clearSelection");
        $("#court_outcome").multiselect("refresh");
        $("#court_outcome").trigger("change");
        $('#next_hearing_date').val('');
        $('#next_mention_date').val('');
        $('#plea_taken').val('');
        $('#application_outcome').val('');
        $('#court_notes').val(''); 
        $("#court_order").multiselect("clearSelection");
        $("#court_session_case").multiselect("refresh");
        $( "#sel_court_order").html('');
        $("#court_msgs").css({ 'display': 'none'})
        $("#btn_save_court").text('Save');
    }

    if(event_type == 'Summon')
    {
        // Reset All Controls/Table
        $('#honoured').val('');
        $('#honoured').trigger('change');
        $('#honoured_date').val('');
        $('#summon_date').val('');
        $('#visit_date').val('');
        $('#summon_note').val('');
        $("#summon_msgs").css({ 'display': 'none'})        
        $("#btn_save_summon").text('Save');
    }

    if(event_type == 'Closure')
    {
        // Reset All Controls/Table
        $("#div_intervention").css({ 'display': "none" });
        $("#case_closure_case").multiselect("clearSelection");
        $("#case_closure_case").multiselect("refresh");
        $("#intervention").multiselect("clearSelection");
        $("#intervention").multiselect("refresh");
        $('#intervention_list').val(''); 
        $('#interventions_manager_table').find("tr:gt(2)").remove();

        $('#case_outcome').val('');
        $("#case_outcome").trigger("change");
        $("#transfered_to").multiselect("clearSelection");
        $("#transfered_to").multiselect("refresh");
        $('#date_of_case_closure').val('');
        $('#case_closure_notes').val('');
        $("#closure_msgs").css({ 'display': 'none'})        
        $("#btn_save_closure").text('Save');
    }
}
function fnNavigateBack()
{
    return window.location.href='{% url 'forms_registry' %}';
}
function fnOpenDialog(dialog_type)
{
    ResetEventsDialog(dialog_type);     
    if(dialog_type == 'Services')
    {
        $('#services-dialog').modal('show');
    }
    if(dialog_type == 'Court')
    {
        $('#court-sessions-dialog').modal('show');
    }
     if(dialog_type == 'Summon')
    {
        $('#summons-dialog').modal('show');
    }
    if(dialog_type == 'Referral')
    {
        $('#manage-referals-dialog').modal('show');
    }
    if(dialog_type == 'Closure')
    {
        var case_status = $('#btn_case_status').text();
        case_status = $.trim(case_status);
        console.log(case_status);
        if(case_status == 'ACTIVE')
        {            
            $('#close-case-dialog').modal('show');            
        }
        else
        {
            /*
            $('#error_msgs').css({'display': 'block'});
            $('#error_msgs p').html('This case has been closed or transferred.');
            */

            $('#closure-warning-dialog').modal('show');
            $('#span_closure_alert').html("This case has been closed or transferred.")
        }
    }
    if(dialog_type == 'CaseStatus')
    {
        $('#case-status-dialog').modal('show');
    }
}
function LoadCaseEvents()
{
    // Load CaseEvents From Database
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = { 
                    'case_id' : case_id,
                    'csrfmiddlewaretoken': csrftoken
                 };
    $.ajax({
                url: '{% url 'manage_case_events' %}',
                dataType: 'json',
                method: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: values,
                success: function(result)
                {
                    // Clear <tbody>
                    $("#case_events_data_table tbody").html('');

                    $.each(result, function(i, val) {
                        var case_event_id = val.case_event_id;
                        var case_event_type = val.case_event_type;
                        var case_event_category = val.case_event_category;
                        var case_event_description = val.case_event_description;
                        var case_event_date = val.case_event_date;

                        var caseEventTypeId = 'caseEventTypeId' + i;
                        var caseEventCategoryId = 'caseEventCategoryId' + i;
                        var caseEventDescriptionId = 'caseEventDescriptionId' + i;
                        var caseEventDateId = 'caseEventDateId' + i;
                        var btnViewCe = 'btnViewCe' + i;
                        var btnEditCe = 'btnEditCe' + i;
                        var btnDeleteCe = 'btnDeleteCe' + i;
                        var btnManageCe = 'btnManageCe' + i;
                        var tableRowId = 'tableRowId' + i;

                        //Actions Item
                        var editItem = '<button id=' + btnEditCe + ' type="submit" class="btn  btn-sm btn-primary m-r-5"><i class="fa fa-edit"></i></button>';
                        var deleteItem = '<button id=' + btnDeleteCe + ' type="submit" class="btn  btn-sm btn-danger m-r-5"><i class="fa fa-trash"></i></button>';
                        var manageItem = '<button id=' + btnManageCe + ' type="submit" class="btn  btn-sm btn-primary m-r-5">Manage <i class="fa fa-share"></i></button>';

                        if (case_event_type == 'REFERRAL')
                        {
                            editItem = manageItem;
                            deleteItem ='';
                        }


                        // Append to rows to table rows
                        $("#case_events_data_table tbody").append('<tr id=' + tableRowId + '>' + 
                            '<td width="10%"><h6>' + case_event_type + '</h6></td>' +
                            '<td width="25%"><h6>' + case_event_category + '</h6></td>' + 
                            '<td width="25%"><h6>' + case_event_description +'</h6></td>' + 
                            '<td width="15%"><h6>' + case_event_date + '</h6></td>' +
                            '<td>' + 
                            '' + editItem + '' +
                            '' + deleteItem + '' +
                            '</td></tr>');

                        // Add Click Event To Buttons      edit_view_delete_CaseEvent(event_type, event_id, action)
                        $("#" + btnManageCe + "").click(function(e)
                        {
                            fnOpenDialog('Referral');
                        });

                        $("#" + btnEditCe + "").click(function(e)
                        {
                            // edit_view_delete_CaseEvent(case_event_type, case_event_id,'EDIT');
                            $('#operation_mode').val('EDIT');
                            if(case_event_type == 'COURT MENTION' || case_event_type == 'COURT HEARING' || case_event_type == 'COURT PLEA' || case_event_type == 'COURT APPLICATION') { fnViewCourtSession(case_event_id);}
                            if(case_event_type == 'SERVICES') { fnViewEncounter(case_event_id);}
                            if(case_event_type == 'CLOSURE') { fnViewClosure(case_event_id);}
                            if(case_event_type == 'SUMMON') { fnViewSummon(case_event_id);}                            
                        }); 

                        $("#" + btnDeleteCe + "").click(function(e)
                        {
                            if(case_event_type == 'COURT MENTION' || case_event_type == 'COURT HEARING' || case_event_type == 'COURT PLEA' || case_event_type == 'COURT APPLICATION') { fnDeleteCourtSession(case_event_id);}
                            if(case_event_type == 'SERVICES') { fnDeleteEncounter(case_event_id);}
                            if(case_event_type == 'CLOSURE') { fnDeleteClosure(case_event_id); }
                            if(case_event_type == 'SUMMON') { fnDeleteSummon(case_event_id); }
                        }); 
                    });
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }

            });  
}
function LoadReferrals()
{
    // Load Referrals From Database
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = { 
                    'case_id' : case_id,
                    'csrfmiddlewaretoken': csrftoken
                 };
    $.ajax({
                url: '{% url 'manage_refferal002' %}',
                dataType: 'json',
                method: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: values,
                success: function(result)
                {
                    // Clear <thead>
                    $("#old_refferals_table thead").html('');

                    // Append to rows to table <thead>
                    $("#old_refferals_table thead").append('<th width="15%"></th>' +
                        '<th width="15%"><h6><b>Date</b></h6></th>' +
                        '<th width="20%"><h6><b>Referral For</b></h6></th>' +
                        '<th width="20%"><h6><b>Case Category Attachment</b></h6></th>' +
                        '<th width="10%"><h6><b>Status</b></h6></th>' +
                        '<th width="15%"><h6><b></b></h6></th>' +
                        '<th width="5%"><h6><b></b></h6></th>');

                    // Clear <tbody>
                    $("#old_refferals_table tbody").html('');

                    $.each(result, function(i, val) {
                        var refferal_id = val.refferal_id;
                        var refferal_to = val.refferal_to;
                        var refferal_status = val.refferal_status;
                        var refferal_enddate = val.refferal_enddate;
                        var refferal_case_category = val.refferal_case_category;

                        // Append rows to #old_refferals_table <tbody>
                        var datePickerId = 'date_referral_completed' + i;
                        var caseCategoryId = 'caseCategory' + i;
                        var divButtonsId = 'divButton' + i;
                        var tableRowId = 'tableRow' + i;
                        var btnEdit = 'btnEdit' + i;
                        var btnSaveChanges = 'btnSaveChanges' + i;
                        var btnCancelChanges = 'btnCancelChanges' + i;
                        var btnRemove = 'btnRemove' + i;
                        var spanCaseCategoryId = 'sel_caseCategory' + i;
                        var spanReferralId = 'spanRefferalId' + i;
                        var hReferralId = "<input id='hReferralId' type='hidden' value='"+refferal_id+"'>"
                        var spanDateInputEditId = 'spanRefferalId' + i;
                        var dateInput_errormsgId = 'dateInput_errormsg' + i;
                        var dateInput;

                        // Determine MArkup For Date Column (Datepicker/Date Text)
                        if(refferal_enddate)
                        { dateInput = '<span id=' + spanDateInputEditId + '>' + refferal_enddate + '</span>'; }
                        else
                        { 
                            dateInput = '<input id=' + datePickerId + ' type="text" value="Date" class="form-control"><div id=' + dateInput_errormsgId + ' style="display:none;"><h6><b><span><p class="dialog_paragraph">This value is required</p></span></b></h6></div>'; 
                        }

                        // Append to rows to table <tbody>
                        $("#old_refferals_table tbody").append('<tr id=' + tableRowId + '>' + 
                            '<td width="15%"><h6>' + hReferralId + '<button id=' + btnEdit + ' type="button" class="btn btn-sm btn-primary m-r-5"><i class="fa fa-edit"></i>&nbsp; <b>Manage</b></button></td>' +
                            '<td width="15%"><h6>' + dateInput + '</h6></td>' +
                            '<td width="20%"><h6>' + refferal_to + '</h6></td>' +
                            '<td width="20%"><h6><select id=' + caseCategoryId + ' name="case_to_attach" class="form-control"></select><span id=' + spanCaseCategoryId + '></span></h6></td>' +
                            '<td width="10%"><h6>' + refferal_status + '</h6></td>' +
                            '<td width="15%"><h6><div id=' + divButtonsId + ' style="display:none"><button id=' + btnSaveChanges + ' type="button" class="btn btn-sm btn-white m-r-5"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp; <b>Save</b></button><button id=' + btnCancelChanges + ' type="button" class="btn btn-sm btn-white m-r-5"><i class="fa fa-close"></i>&nbsp; <b>Cancel</b></button></div></h6></td>' +
                            '<td width="5%"><h6><div id="divRemove"><button id=' + btnRemove + ' class="btn btn-sm btn-danger m-r-5"><i class="fa fa-trash"></i></button></div></h6></td>' +
                            '</tr>');

                        // Add Click Event To Remove Buttons
                        $("#" + btnRemove + "").click(function(e)
                        {
                            var referral_id = $('#old_refferals_table tr').find('input[id="hReferralId"]').val();
                            fnDeleteReferral(referral_id);    
                        }); 

                        // Datepicker to Capture Date Referral was Completed   
                        $("#" + datePickerId + "").datepicker({
                            dateFormat: 'yy-mm-dd', format: 'dd-M-yyyy',
                            endDate: '+0d', enddate: '+0d', autoclose: true
                        }); 
                        $("#" + datePickerId + "").prop('disabled', true);            

                        // Populate multiSelects With Case Categorys For This Case
                        var multiselect_data = [];
                        values['action'] = 1;
                        $.ajax({
                            url: '{% url 'getJsonObject001' %}',
                            dataType: 'json',
                            method: 'POST',
                            data: values,
                            success: function(result)
                            {
                                var multiselect_dict = {};
                                var multiselect_dict_initial = { label:'Please Select', value:''};
                                multiselect_data.push(multiselect_dict_initial);
                                $.each(result, function(i, val) {
                                    var case_category_id = val.case_category_id;
                                    var case_category = val.case_category;
                                    var multiselect_dict = { label: case_category, value: case_category_id };
                                    multiselect_data.push(multiselect_dict);
                                }); 

                                //Case To Attach - multi selects
                                $("#" + caseCategoryId + "").multiselect({
                                    selectMultiple: false,
                                    selectAllValue: 'multiselect-all',
                                    includeSelectAllOption: true,
                                    enableCaseInsensitiveFiltering: true,
                                    numberDisplayed: 1,
                                    maxHeight: 300,
                                    buttonWidth: '100%',
                                    buttonClass: 'btn btn-white'
                                });                                
                                $("#" + caseCategoryId + "").multiselect('dataprovider', multiselect_data);

                                // Disable CaseCategory Attachment Multiselect  
                                $("#" + caseCategoryId + "").multiselect('disable');   

                                // Set Selected Options
                                if(refferal_case_category)
                                {
                                    // alert(refferal_case_category_id);
                                    $("#" + caseCategoryId + "").val(refferal_case_category); 
                                    $("#" + caseCategoryId + "").multiselect("refresh");
                                }                                
                            },
                            error: function(xhr, status, error)
                            {
                                alert(error);
                            }
                        });

                        /* ---------------------------- ACTION EVENTS -------------------------------*/                        

                        // Attach Change() Event to CaseCateory Multiselect
                        $("#" + caseCategoryId + "").change(function(event) 
                        { 
                           displayVals(caseCategoryId);
                        });   
                        $("#" + caseCategoryId + "").trigger('change'); 

                        // Add Click Event To buttonEdit
                        $("#" + btnEdit + "").click(function(e)
                        {
                            var refferal_status = $('#old_refferals_table tr#' + tableRowId).find('td:eq(4)').text();

                            // alert(refferal_status);
                            
                            if(refferal_status == 'COMPLETED')
                            {
                                alert('This referral has been Managed!');
                            }
                            else
                            {                            
                                //Enable DatePicker/CaseCategory Dropdown
                                $("#" + datePickerId + "").prop('disabled', false);

                                // Enable CaseCategory Attachment Multiselect  
                                $("#" + caseCategoryId + "").multiselect('enable'); 

                                var refferal_enddate_ = $('#old_refferals_table').find('tr#' + tableRowId + ' span:eq(1)').text(); 
                                
                                if(refferal_enddate_)
                                {
                                    refferal_enddate_ = new Date(refferal_enddate_);


                                    if(refferal_enddate_ == 'Invalid Date')
                                    {
                                        $("#" + divButtonsId + "").css({ 'display': "block" }); 
                                    }
                                    else
                                    {
                                        $('#old_refferals_table').find('tr#' + tableRowId).find('td:eq(1)').html('<input id=' + datePickerId + ' type="text" class="form-control">')

                                        // Set Datepicker on Edit
                                        $("#" + datePickerId + "").datepicker({
                                            dateFormat: 'yy-mm-dd', format: 'dd-M-yyyy',
                                            endDate: '+0d', enddate: '+0d', autoclose: true
                                        });
                                        $("#" + datePickerId + "").datepicker('setDate', new Date(refferal_enddate_));   
                                    }
                                    $("#" + divButtonsId + "").css({ 'display': "block" });                                
                                }                                
                            }
                        });

                        // Add Click Event To btnSaveChanges
                        $("#" + btnSaveChanges + "").click(function(e)
                        {
                            // Get Row id
                            var tableRowId = 'tableRow' +i;

                            // Get User Inputs Per Row
                            var date_referral_completed = $('#old_refferals_table').find('tr#' + tableRowId).find('input[id=' + datePickerId + ']').val();
                            var referral_id = $('#old_refferals_table tr').find('input[id="hReferralId"]').val();
                            // var refferal_id = $('#old_refferals_table').find('tr#' + tableRowId + ' span:eq(0)').text();
                            var case_category_ids = $('#old_refferals_table').find('tr#' + tableRowId).find('#' + caseCategoryId + '').val();

                            if(date_referral_completed)
                            {
                                var ReferralsData = {
                                "refferal_id" : refferal_id,
                                "date_referral_completed" : date_referral_completed,
                                "case_category_ids": case_category_ids
                                 }
                                ReferralsData = JSON.stringify(ReferralsData);
                                var values = {  
                                    'csrfmiddlewaretoken': csrftoken,
                                    'case_id':case_id,
                                    'ReferralsData':ReferralsData
                                };

                                $.ajax({
                                    url: '{% url 'manage_refferal003' %}',
                                    dataType: 'json',
                                    method: 'POST',
                                    contentType: 'application/x-www-form-urlencoded',
                                    data: values,
                                    success: function(data)
                                    {
                                        $("#referral_msgs").css({ 'display': "block" }); 
                                        $('#referral_msgs p').html('Referral Managed Successfully - Details updated.');

                                        /* Reload Referrals */
                                        LoadReferrals();

                                        /* Reload CaseEvents */
                                        LoadCaseEvents();

                                        /* Reload Case Summary Div */
                                        $("#div_case_summary").load(location.href + " #div_case_summary");

                                        $("#" + dateInput_errormsgId + "").css({ 'display': "none" });

                                        //Disable DatePicker/CaseCategory Dropdown
                                        $("#" + datePickerId + "").prop('disabled', true);

                                        // Disable CaseCategory Attachment Multiselect  
                                        $("#" + caseCategoryId + "").multiselect('disable');
                                    },
                                    error: function(e)
                                    {
                                        console.log(e)
                                    }
                                });
                            }
                            else
                            {
                                $("#" + dateInput_errormsgId + "").css({ 'display': "block" });
                            }                            
                        });

                        // Add Click Event To btnCancelChanges
                        $("#" + btnCancelChanges + "").click(function(e)
                        {
                            var referralStatus = $('#old_refferals_table').find('tr#' + tableRowId + ' td:eq(4)').text();
                            if(referralStatus == 'COMPLETED')
                            {
                                var date_referral_completed = $('#old_refferals_table').find('tr#' + tableRowId).find('input[id=' + datePickerId + ']').val();
                                $('#old_refferals_table').find('tr#' + tableRowId).find('td:eq(1)').html('<span><h6>' + date_referral_completed + '</h6></span>')
                            }

                            $("#" + divButtonsId + "").css({ 'display': "none" });                           
                            $("#" + dateInput_errormsgId + "").css({ 'display': "none" });

                            //Disable DatePicker/CaseCategory Dropdown
                            $("#" + datePickerId + "").prop('disabled', true);
                            $("#" + datePickerId + "").val('');
                            $("#" + datePickerId + "").attr("placeholder", "Date");

                            // Disable CaseCategory Attachment Multiselect  
                            $("#" + caseCategoryId + "").multiselect('disable');
                            $("#" + caseCategoryId + "").multiselect('clearSelection');
                            $("#" + caseCategoryId + "").multiselect('refresh');
                            $("#sel_" + caseCategoryId + "").html('');
                        }); 
                    });
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }

            });  
}
function AddRow(x)
{
    /* 
    Create JsonObjects To Hold Data From Grids 
    */

    if(x == 1) // Refferals Table
    {
        var refferal_case = $("#refferal_case").val();
        var refferals_actor = $("#refferals_actor").val();
        var refferals_actor_specify = $("#refferals_actor_specify").val();
        var refferals_made = $("#refferals_made").val();
        var case_id = $('#case_id').val();
        var ReferralsData = new Array();
        var data = new Array();
        var csrftoken = $.cookie('csrftoken');
        var values = { 
                        'action' : 0, // Save new referral 
                        'case_id' : case_id,
                        'csrfmiddlewaretoken': csrftoken
                     };
        if(refferal_case)
        {
            if(refferals_actor)
            {
                if(refferals_actor_specify)
                {
                    if(refferals_made)
                    {
                        ReferralsData = {
                            "refferal_case" : refferal_case,
                            "refferals_actor" : refferals_actor,
                            "refferals_actor_specify" : refferals_actor_specify,
                            "refferals_made" : refferals_made
                        };
                        ReferralsData = JSON.stringify(ReferralsData);

                        values['ReferralsData'] = ReferralsData;
                        $.ajax({
                                    url: '{% url 'manage_refferal' %}',
                                    dataType: 'json',
                                    method: 'POST',
                                    contentType: 'application/x-www-form-urlencoded',
                                    data: values,
                                    success: function(result)
                                    {
                                        //On success - Get referral_grouping_id from Json to be used onRemove()
                                        var referral_grouping_id;
                                        $.each(result, function(i, val) {
                                            referral_grouping_id = val.referral_grouping_id;
                                        });

                                        // Find a <table> element with id="myTable":
                                        var table = $('#new_refferals_table')[0]; 

                                        // Create an empty <tr> element with id and add it to the 1st position of the table:
                                        var rows_length = table.rows.length;
                                        var row = table.insertRow(rows_length);
                                        var rowId = row.id = "id_" + (rows_length-2);

                                        //Insert new cells (<td> elements) of the "new" <tr> element:
                                        var cell0 = row.insertCell(0);
                                        var cell1 = row.insertCell(1);
                                        var cell2 = row.insertCell(2);
                                        var cell3 = row.insertCell(3);
                                        var cell4 = row.insertCell(4);
                                        var cell5 = row.insertCell(5);

                                        cell0.className = 'td_style';
                                        cell1.className = 'td_style';
                                        cell2.className = 'td_style';
                                        cell3.className = 'td_style';
                                        cell4.className = 'td_style';
                                        cell5.className = 'td_style';

                                        // Add some text to the new cells:
                                        var index = rows_length - 1;
                                        cell0.innerHTML =  "<h6>" + (index) + "</h6>" + "<div id='span_referral_grouping_id' style='display:none'><span>" + referral_grouping_id + "</span></div>";
                                        cell1.innerHTML = '<h6>' + $('#refferal_case option:selected').text() + '</h6>';
                                        cell2.innerHTML = '<h6>' + $('#refferals_actor option:selected').text() + '</h6>';
                                        // cell3.innerHTML = '<h6>' + $('#refferals_actor_specify').val() + '</h6>';
                                        cell3.innerHTML = '<h6>' + $('#refferals_actor_specify option:selected').text() + '</h6>';
                                        cell4.innerHTML = '<h6>' + $('#refferals_made option:selected').text() + '</h6>';
                                        cell5.innerHTML  = "<button id=btnRemove" + index +" class='btn btn-sm btn-link m-r-5'><b>Remove</b></button>"

                                        // AddClick EVent To Remove Button
                                        var btnRemoveId = 'btnRemove' + index;
                                        var span_referral_grouping_id = $("#" + rowId + " span:eq(0)").text(); 
                                        $("#" + btnRemoveId + "").click(function(e)
                                        {
                                            RemoveRow(2, span_referral_grouping_id, rowId);
                                        }); 

                                        // Reset Input Elements/Error Divs
                                        $("#refferal_case").multiselect("clearSelection");
                                        $("#refferal_case").multiselect("refresh");
                                        $( "#sel_refferal_case").html('')

                                        $("#refferals_actor").multiselect("clearSelection");
                                        $("#refferals_actor").multiselect("refresh");
                                        $("#sel_refferals_actor").html('');

                                        // $("#refferals_actor_specify").val('');
                                        $("#refferals_actor_specify").multiselect("clearSelection");
                                        $("#refferals_actor_specify").multiselect("refresh");
                                         $("#sel_refferals_actor_specify").html('');

                                        $("#refferals_made").multiselect("clearSelection");
                                        $("#refferals_made").multiselect("refresh");
                                        $( "#sel_refferals_made").html('')

                                        $("#referral_event_msgs").css({ 'display': "none" });

                                        /* Reload List */
                                        LoadReferrals();

                                        /* Reload CaseEvents */
                                        LoadCaseEvents();

                                        /* Reload Case Summary Div */
                                        $("#div_case_summary").load(location.href + " #div_case_summary");
                                    },
                                    error: function(xhr, status, error)
                                    {
                                        alert(error);
                                    }

                                });      
                    }
                    else
                    {
                        $("#refferals_made_errormsg").css({ 'display': "block" }); 
                        $("#referral_event_msgs").css({ 'display': "block" }); 
                        $('#referral_event_msgs p').html('Please fill the missing values');
                    }        
                }
                else
                {
                    $("#refferals_actor_specify_errormsg").css({ 'display': "block" }); 
                    $("#referral_event_msgs").css({ 'display': "block" }); 
                    $('#referral_event_msgs p').html('Please fill the missing values');
                }  
            }
            else
            {
                $("#refferals_actor_errormsg").css({ 'display': "block" }); 
                $("#referral_event_msgs").css({ 'display': "block" }); 
                $('#referral_event_msgs p').html('Please fill the missing values');
            }
        }
        else
        {
            $("#refferal_case_errormsg").css({ 'display': "block" });
            $("#referral_event_msgs").css({ 'display': "block" }); 
            $('#referral_event_msgs p').html('Please fill the missing values');
        }        
    }
    if(x == 2) // Encounters/Services Table
    {
        var service_provided = $("#service_provided").val();
        var date_of_encounter_event = $("#date_of_encounter_event").val();
        var service_provider = $("#service_provider").val();
        var place_of_service = $("#place_of_service").val();
        var csrftoken = $.cookie('csrftoken');        
        var values = {  
            'csrfmiddlewaretoken': csrftoken
        };
        var EncountersData = new Array();

        // Perform Ajax() to create jsonObjectArrayServices
        if(service_provided)
        {
            if(date_of_encounter_event)
            {
                if(service_provider)
                {
                    if(place_of_service)
                    {
                        // Find a <table> element with id="myTable":
                        var table = $('#services_manager_table')[0]; 

                        // Create an empty <tr> element with id and add it to the 1st position of the table:
                        var rows_length = table.rows.length;
                        var row = table.insertRow(rows_length);
                        var index = rows_length - 2;
                        row_id = 'rowid_' + index;
                        row.id = row_id;
                        var btnRemoveSvcId = 'btnRemoveSvc' + index;

                        // Insert new cells (<td> elements) of the "new" <tr> element:
                        var cell0 = row.insertCell(0);
                        var cell1 = row.insertCell(1);
                        var cell2 = row.insertCell(2);
                        var cell3 = row.insertCell(3);
                        var cell4 = row.insertCell(4);
                        var cell5 = row.insertCell(5);

                        cell0.className = 'td_style';
                        cell1.className = 'td_style';
                        cell2.className = 'td_style';
                        cell3.className = 'td_style';
                        cell4.className = 'td_style';
                        cell5.className = 'td_style';

                        // Add some text to the new cells:
                        var hservice_provided = "<input id='hservice_provided' type='hidden' value='"+service_provided+"'>"
                        var hservice_provider = "<input id='hservice_provider' type='hidden' value='"+service_provider+"'>"
                        var hservice_status= "<input id='hservice_status' type='hidden' value='new'>"

                        cell0.innerHTML = '<h6>#</h6>';        
                        cell1.innerHTML = '<h6>' + displayVals3("service_provided") + hservice_provided + '</h6>';
                        cell2.innerHTML = '<h6>' + $('#date_of_encounter_event').val() + '</h6>';
                        cell3.innerHTML = '<h6>' + displayVals3("service_provider") + hservice_provider + '</h6>';
                        cell4.innerHTML = '<h6>' + $('#place_of_service').val() + hservice_status + '</h6>';
                        cell5.innerHTML  = '<h6>' + "<a id=" + btnRemoveSvcId + " class='btn btn-sm btn-link m-r-5 href='#'>Remove</a>" + '</h6>';

                        // AddClick Event To Remove Button
                        $("#" + btnRemoveSvcId + "").click(function(e)
                        {
                            RemoveRow(1, '', row_id);
                        });

                        // Reset Input Elements/Error Divs
                        $("#service_provided").multiselect("clearSelection");
                        $("#service_provided").multiselect("refresh");
                        $('#date_of_encounter_event').val('');
                        $("#service_provider").multiselect("clearSelection");
                        $('#place_of_service').val('');
                        $( "#sel_service_provided").html('');
                        $('#service_provided_list').val(''); 

                        $('#services_manager_table tr').each(function(row, tr)
                        {                            
                            var service_provided = $(tr).find('input[id="hservice_provided"]').val();
                            var date_of_encounter_event = $(tr).find('td:eq(2)').text();
                            var service_provider = $(tr).find('input[id="hservice_provider"]').val();
                            var place_of_service = $(tr).find('td:eq(4)').text();
                            var service_status = $(tr).find('input[id="hservice_status"]').val();

                            EncountersData[row]= {
                                "service_provided" : service_provided,
                                "date_of_encounter_event" : date_of_encounter_event,
                                "service_provider" : service_provider,
                                "place_of_service" : place_of_service,
                                "service_status" : service_status
                                }                                
                            
                        });
                        
                        EncountersData.shift(); //remove first row(headers stuff)
                        EncountersData.shift(); //remove second row(controls stuff)
                        EncountersData = JSON.stringify(EncountersData); 

                        // Set service_provided_list
                        $('#service_provided_list').val(EncountersData); 
                    } 
                    else
                    {
                        $("#place_of_service_errormsg").css({ 'display': "block" }); 
                    }         
                }
                else
                {
                    $("#service_provider_errormsg").css({ 'display': "block" }); 
                }
            }
            else
            {
                $("#date_of_encounter_event_errormsg").css({ 'display': "block" }); 
            }
        }
        else
        {
            $("#service_provided_errormsg").css({ 'display': "block" }); 
        }       
    }

    if(x==3)
    {
        var case_category = $("#case_closure_case").val();
        var intervention = $("#intervention").val();
        var csrftoken = $.cookie('csrftoken');        
        var values = {  
            'csrfmiddlewaretoken': csrftoken
        };
        var InterventionsData = new Array();

        if(case_category)
        {
            if(intervention)
            {
                // Find a <table> element with id="myTable":
                var table = $('#interventions_manager_table')[0]; 

                // Create an empty <tr> element with id and add it to the 1st position of the table:
                var rows_length = table.rows.length;
                var row = table.insertRow(rows_length);
                var index = rows_length - 2;
                row_id = 'rowid_' + index;
                row.id = row_id;
                var btnRemoveIntvId = 'btnRemoveIntv' + index;

                // Insert new cells (<td> elements) of the "new" <tr> element:
                var cell0 = row.insertCell(0);
                var cell1 = row.insertCell(1);
                var cell2 = row.insertCell(2);
                var cell3 = row.insertCell(3);

                cell0.className = 'td_style';
                cell1.className = 'td_style';
                cell2.className = 'td_style';
                cell3.className = 'td_style';

                // Add some text to the new cells:
                var hcase_category = "<input id='hcase_category' type='hidden' value='"+case_category+"'>"
                var hintervention = "<input id='hintervention' type='hidden' value='"+intervention+"'>"
                var hintervention_status= "<input id='hintervention_status' type='hidden' value='new'>"

                cell0.innerHTML = '<h6>#</h6>';        
                cell1.innerHTML = '<h6>' + displayVals3("case_closure_case") + hcase_category + '</h6>';
                cell2.innerHTML = '<h6>' + displayVals3("intervention") + hintervention + hintervention_status + '</h6>';
                cell3.innerHTML  = '<h6>' + "<a id=" + btnRemoveIntvId + " class='btn btn-sm btn-link m-r-5 href='#'>Remove</a>" + '</h6>';

                // AddClick Event To Remove Button
                $("#" + btnRemoveIntvId + "").click(function(e)
                {
                    RemoveRow(3, '', row_id);
                });

                // Reset Input Elements/Error Divs
                // $("#div_intervention").css({ 'display': "none" });
                $("#case_closure_case").multiselect("clearSelection");
                $("#case_closure_case").multiselect("refresh");
                $("#intervention").multiselect("clearSelection");
                $("#intervention").multiselect("refresh");
                $('#intervention_list').val(''); 
                //$('#interventions_manager_table').find("tr:gt(2)").remove();

                $('#interventions_manager_table tr').each(function(row, tr)
                {                            
                    var case_category = $(tr).find('input[id="hcase_category"]').val();
                    var intervention = $(tr).find('input[id="hintervention"]').val();
                    var intervention_status = $(tr).find('input[id="hintervention_status"]').val();

                    InterventionsData[row]= {
                        "case_category" : case_category,
                        "intervention" : intervention,
                        "intervention_status" : intervention_status
                        }                                
                    
                });
                
                InterventionsData.shift(); //remove first row(headers stuff)
                InterventionsData.shift(); //remove second row(controls stuff)
                InterventionsData = JSON.stringify(InterventionsData); 

                // Set intervention_list
                $('#intervention_list').val(InterventionsData);
            }
            else
            {
                $("#intervention_errormsg").css({ 'display': "block" }); 
            }
        }
        else
        {
            $("#case_closure_case_errormsg").css({ 'display': "block" }); 
        }
    }    
}
function EditRow(x, id)
{
    if(x == 1) // Refferals Table
    {
    }
    if(x == 2) // Encounters/Services Table
    {
        /* 
        Set RowId Of Clicked Row - This will be used when populating Clicked tr cells with data
        
        alert(id);
        rowId = 'id_inputElements' + String(rowIndex)
        $('#row_id').val(rowId)
        alert(id);*/

        var service_grouping_id = id; 
        var csrftoken = $.cookie('csrftoken');
        var values = {  
                        'csrfmiddlewaretoken': csrftoken,
                        'service_grouping_id': service_grouping_id
                     };
        $.ajax({
            url: '{% url 'manage_encounters004' %}',
            dataType: "json",
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: values,
            success: function(result)
            {
                //On success - Get Json From View/Populate Multiselects
                var service_provided;
                var place_of_service;
                var date_of_encounter_event;
                $.each(result, function(i, val) {
                    service_provided = val.service_provided_list;
                    place_of_service = val.place_of_service_list;
                    date_of_encounter_event = val.date_of_encounter_event_list;
                });
                 
                $('#date_of_encounter_event').datepicker('setDate', new Date(date_of_encounter_event[0]));
                $('#place_of_service').val(place_of_service);
                $('#service_provided').val(service_provided);
                $("#service_provided").multiselect("refresh");
                $('#service_provided').trigger('change');

                // Show Save/Cancel Buttons For This edit
                $("#btnSaveChanges").css({ 'display': "block" }); 
                $("#btnCancelChanges").css({ 'display': "block" }); 
            },
            error: function(e)
            {
                console.log(e)
            }
        });
    }
}


function RemoveRow(index, uuid, tr_id)
{
    if(index == 1)
    {
        // Delete Table Row
        $("#" + tr_id).remove();

        var EncountersData = new Array();
        $('#services_manager_table tr').each(function(row, tr)
        {                            
            var service_provided = $(tr).find('input[id="hservice_provided"]').val();
            var date_of_encounter_event = $(tr).find('td:eq(2)').text();
            var service_provider = $(tr).find('input[id="hservice_provider"]').val();
            var place_of_service = $(tr).find('td:eq(4)').text();
            var service_status = $(tr).find('input[id="hservice_status"]').val();

            EncountersData[row]= {
                "service_provided" : service_provided,
                "date_of_encounter_event" : date_of_encounter_event,
                "service_provider" : service_provider,
                "place_of_service" : place_of_service,
                "service_status" : service_status
                }                                
            
        });
        
        EncountersData.shift(); //remove first row(headers stuff)
        EncountersData.shift(); //remove second row(controls stuff)
        EncountersData = JSON.stringify(EncountersData); 

        // Set service_provided_list
        $('#service_provided_list').val(EncountersData);
    }
    if(index == 2)
    {

        if(uuid)
        {
            var data = new Array();
            var csrftoken = $.cookie('csrftoken');
            var values = {  
                            'referral_grouping_id' : uuid,
                            'csrfmiddlewaretoken': csrftoken
                         };
            $.ajax({
                        // url: '{% url 'manage_casecategory001' %}',
                        url: '{% url 'manage_refferal001' %}',
                        dataType: 'text',
                        method: 'POST',
                        contentType: 'application/x-www-form-urlencoded',
                        data: values,
                        success: function(result)
                        {
                            //Delete Table Row
                            $("#" + tr_id).remove();

                            $('#new_refferals_table tr').each(function(row, tr)
                            {
                                var rowIndex = parseInt(tr.rowIndex);
                                if(rowIndex > 1)
                                {
                                    $(tr).find('td:eq(0)').text(rowIndex-1);
                                }
                            });

                            /* reload referrals */
                            LoadReferrals();
                        },
                        error: function(xhr, status, error)
                        {
                            alert(error);
                        }

                    });  
        } 
    }
    if(index == 3)
    {
        // Delete Table Row
        $("#" + tr_id).remove();

        var InterventionsData = new Array();
        $('#interventions_manager_table tr').each(function(row, tr)
        {                            
            var case_category = $(tr).find('input[id="hcase_category"]').val();
            var intervention = $(tr).find('input[id="hintervention"]').val();
            var intervention_status = $(tr).find('input[id="hintervention_status"]').val();

            InterventionsData[row]= {
                "case_category" : case_category,
                "intervention" : intervention,
                "intervention_status" : intervention_status
                }                                
            
        });
        
        InterventionsData.shift(); //remove first row(headers stuff)
        InterventionsData.shift(); //remove second row(controls stuff)
        InterventionsData = JSON.stringify(InterventionsData); 

        // Set intervention_list
        $('#intervention_list').val(InterventionsData);
    }
}
function edit_view_delete_CaseEvent(event_type, event_id, action)
{
    /*
     Set Mode To EDIT/VIEW. 
     Use this value in Ajax to switch url params
     */
    //alert(event_id);
    $('#operation_mode').val(action.trim());
    var event_type = event_type.trim();
    var event_id = event_id.trim();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':event_id
    };


    // case_event_id
    $('#case_event_id_svc').val(event_id);
    $('#case_event_id_court').val(event_id);
    $('#case_event_id_plcmt').val(event_id);

    if(event_type == 'SERVICES')
    {
        // ResetEventsDialog('Services');
        var services_array = new Array();

        $.ajax({
            url: '{% url 'view_encounter' %}',
            dataType: 'json',
            method: 'POST',
            data: values,
            success: function(result)
            { 
                // change dialog-title & show save button on EDIT
                if(action == 'VIEW')
                {
                    // show dialog
                    $('#services-dialog').modal('show');

                    //Hide Controls in Table
                    $('#id_inputElements').hide();

                    //disable inputs - view mode
                    $('#encounter_notes').prop("readonly", true); 

                    $('#services-dialog-header p').html('View Encounters / Services &nbsp;&nbsp;<i class="fa fa-gears"></i>');  
                    $("#btn_save_encounter").hide();
                }
                if(action == 'EDIT')
                {
                    //Show Controls in Table
                    $('#id_inputElements').show();

                    // show dialog
                    $('#services-dialog').modal('show');

                    //enable inputs - edit mode
                    $('#service_provided').prop("readonly", false);
                    $('#date_of_encounter_event').prop("readonly", false);
                    $('#encounter_notes').prop("readonly", false); 

                    $('#services-dialog-header p').html('Edit Encounters / Services &nbsp;&nbsp;<i class="fa fa-gears"></i>');  
                    $("#btn_save_encounter").show();
                } 
                if(action == 'DELETE')
                {
                    $('#div-delete-doalog p').html('Do you want to delete '+  event_type + ' EVENT (' + event_id + ')?');
                    // show dialog
                    $('#delete-dialog').modal('show');
                }  

                // Populate Grid
                $.each(result, function(i, val) {
                    var date_of_event = val.date_of_event;
                    var encounter_notes = val.case_event_notes;
                    var case_category = val.case_category;
                    var resultsets = val.resultsets;

                    $.each(resultsets, function(i, resultset)
                    {
                        $.each(resultset, function(i, result)
                        { 
                            // Remove pre-exisiting rows 
                            $('#id_inputElements' + i + '').remove();

                            var rowIndex = i;
                            var service_provided = result.service_provided;
                            var date_of_encounter_event = result.date_of_encounter_event;
                            var service_provider = result.service_provider;
                            var place_of_service = result.place_of_service;
                            var service_grouping_id = result.service_grouping_id;

                            var table_row = '<tr id=id_inputElements' + i +'><td><h6>' + (i+1) + '</h6></td><td><h6>' + service_provided + '</h6></td><td><h6>' + date_of_encounter_event + '</h6></td><td><h6>' + service_provider + '</h6></td><td><h6>' + place_of_service + '</h6></td><td><button id=btnEdit' + (i+1) +' type="button" class="btn btn-sm btn-link m-r-5" onClick="EditRow(2,\''+service_grouping_id+'\')"><i class="fa fa-edit" ></i>&nbsp; Edit</b></button></td></tr>'                           

                            // Append each result to  row
                            $('#services_manager_table > tbody:last-child').append(table_row);
                        });
                    });
                    $('#encounter_notes').val(encounter_notes);
                    $('#service_provided_case').val(case_category); 
                    $('#service_provided_case').multiselect('refresh'); 
                });                     
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }
    else if(event_type == 'COURT')
    {
        /// ResetEventsDialog('Court');
        var court_sessions_array = new Array();

        $.ajax({
                url: '{% url 'view_court' %}',
                dataType: 'json',
                method: 'POST',
                data: values,
                success: function(result)
                { 
                    $.each(result, function(i, val) {
                        var date_of_court_event = val.date_of_event;
                        var court_notes = val.case_event_notes;
                        var court_outcome = val.court_outcome;
                        var next_hearing_date = val.next_hearing_date;
                        var court_orders = ((val.ovc_court_orders).toString()).split(",");
                        var case_category_id = ((val.ovc_category_ids).toString()).split(",");

                        for(var i =0; i < court_orders.length; i++)
                        {
                            $("#court_order option[value='" + court_orders[i] + "']").prop("selected", true);
                        }
                        $('#sel_court_order').html('')
                        $("#court_order").multiselect("refresh");
                        $('#court_order').trigger('change');

                        $('#date_of_court_event').datepicker('setDate', dateHandler(date_of_court_event));
                        $('#court_notes').val(court_notes);

                        $('#court_outcome').val(court_outcome);
                        $("#court_outcome").multiselect("refresh");
                        $('#court_outcome').trigger('change')
                        if(next_hearing_date){ $('#next_hearing_date').datepicker('setDate', dateHandler(next_hearing_date)); }                        

                        $('#court_session_case').val(case_category_id); 
                        $("#court_session_case").multiselect("refresh");
                        });

                    // change dialog-title & show save button on EDIT
                    if(action == 'VIEW')
                    {
                        // show dialog
                        $('#court-sessions-dialog').modal('show');

                        //disable inputs - view mode
                        $('#court_session_case').multiselect('disable');
                        $('#court_order').multiselect('disable');
                        $('#date_of_court_event').prop("readonly", true);
                        $('#court_outcome').multiselect('disable');
                        $('#next_hearing_date').prop("readonly", true);
                        $('#court_notes').prop("readonly", true);

                        $('#court-sessions-dialog p').html('View Court Session &nbsp;&nbsp;<i class="fa fa-legal"></i>');     
                        $("#btn_save_court").hide();
                    }
                    if(action == 'EDIT')
                    {
                        // show dialog
                        $('#court-sessions-dialog').modal('show');

                        //enable inputs - edit mode
                        $('#court_session_case').multiselect('enable');
                        $('#court_order').multiselect('enable');
                        $('#date_of_court_event').prop("readonly", false);
                        $('#court_outcome').multiselect('enable');
                        $('#next_hearing_date').prop("readonly", true);
                        $('#court_notes').prop("readonly", false);

                        $('#court-sessions-dialog p').html('Edit Court Session &nbsp;&nbsp;<i class="fa fa-legal"></i>');     
                        $("#btn_save_court").show();
                    } 
                    if(action == 'DELETE')
                    {
                        $('#div-delete-doalog p').html('Do you want to delete '+  event_type + ' EVENT (' + event_id + ')?');
                        // show dialog
                        $('#delete-dialog').modal('show');
                    } 
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
        });       
    }
    
}

function getJsonObject001()
{
    var case_id = $('#case_id').val();
    var action = 1;
    var multiselect_data = [];
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'case_id': case_id,
        'action': action   
    };

    $.ajax({
            url: '{% url 'getJsonObject001' %}',
            dataType: 'json',
            method: 'POST',
            data: values,
            success: function(result)
            {
                var multiselect_dict = {};
                var multiselect_dict_initial = { label:'Please Select', value:''};
                multiselect_data.push(multiselect_dict_initial);
                $.each(result, function(i, val) {
                    var case_category_id = val.case_category_id;
                    var case_category = val.case_category;
                    var multiselect_dict = { label: case_category, value: case_category_id };
                    multiselect_data.push(multiselect_dict);
                }); 

                //multi selects
                $('#service_provided_case, #court_session_case').multiselect({
                    selectAllValue: 'multiselect-all',
                    enableCaseInsensitiveFiltering: true,
                    numberDisplayed: 1,
                    maxHeight: 300,
                    buttonWidth: '100%',
                    buttonClass: 'btn btn-white'
                }); 
                $("#service_provided_case").multiselect("refresh");
                $("#service_provided_case").multiselect('dataprovider', multiselect_data); 

                $("#court_session_case").multiselect("refresh");
                $("#court_session_case").multiselect('dataprovider', multiselect_data); 

                
                $("#refferal_case").multiselect("refresh");
                $("#refferal_case").multiselect('dataprovider', multiselect_data);

                $("#case_closure_case").multiselect("refresh");
                $("#case_closure_case").multiselect('dataprovider', multiselect_data);      
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
}
function dateHandler(mydate)
{
    if(mydate)
    {       
        var my_date = mydate.split(" ")
        var date_array = new Array();
        for(var i =0; i < my_date.length; i++)
        {
            date_array.push(my_date[i]);
        }
        
        var date = date_array[0];
        date = new Date(date) 

        return date;
    }
}
function deleteCaseEvent_()
{
    var event_type = $('#case_event_type').val().trim();
    var event_id = $('#case_event_id').val().trim();

    if(event_type)
    {
        if(event_id)
        {
            // Call deleteCaseEvent(event_type, event_id)
            deleteCaseEvent(event_type, event_id);
        }
        else
        {
            alert('Missing value - event_id')
        }
    }
    else
    {
        alert('Missing value - event_type');
    }
    
}
function deleteCaseEvent(event_type, event_id)
{
    if(event_type == 'SERVICES')
    {
        var crudMsg = 'Encounter/Services Deleted Successfully!';
        var services_array = new Array();
        var csrftoken = $.cookie('csrftoken');
        var values = {  
            'csrfmiddlewaretoken': csrftoken,
            'event_id':event_id
        };

        $.ajax({
            url: '{% url 'delete_encounter' %}',
            dataType: 'text',
            method: 'POST',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" }); 
                $('#ce_msgs p').html(crudMsg);
                $('#case-events').load(document.URL +  ' #case-events'); 

                //close delete-dialog
                $('#delete-dialog').modal('hide');
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }
    
    if(event_type == 'COURT')
    {
        var crudMsg = 'Court Orders Deleted Successfully!';
        var services_array = new Array();
        var csrftoken = $.cookie('csrftoken');
        var values = {  
            'csrfmiddlewaretoken': csrftoken,
            'event_id':event_id
        };

        $.ajax({
            url: '{% url 'delete_court' %}',
            dataType: 'text',
            method: 'POST',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" }); 
                $('#ce_msgs p').html(crudMsg);
                $('#case-events').load(document.URL +  ' #case-events'); 

                //close delete-dialog
                $('#delete-dialog').modal('hide');
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }
}

function fnSaveClosure()
{
    var operation_mode = $('#operation_mode').val(); 
    if(operation_mode == 'EDIT')
    { 
        fnUpdateClosure();
        return false;
    }

    var crudMsg = 'Case Closed Successfully.';
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    // var case_status = $('#case_status').val();
    var case_outcome = $('#case_outcome').val(); 
    var transfered_to = $('#transfered_to').val(); 
    var intervention_list = $('#intervention_list').val(); 
    var case_closure_notes = $('#case_closure_notes').val(); 
    var date_of_case_closure = $('#date_of_case_closure').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id
                }
    
    if(case_outcome)
    {
        values['case_outcome'] = case_outcome;
        if(case_outcome == 'COTR')
        {
            if(transfered_to)
            {
                values['transfered_to'] = transfered_to;
            }
            else
            {
                $("#closure_msgs3").css({ 'display': "block" });
                $("#closure_msgs").css({ 'display': "block" });
                $('#closure_msgs p').html('Please fill the missing values');
                return false;
            }
        }

        if(case_outcome == 'COOT')
        {
            if(intervention_list)
            {
                values['intervention_list'] = intervention_list.toString();
            }
            else
            {
                $("#closure_msgs6").css({ 'display': "block" });
                $("#closure_msgs").css({ 'display': "block" });
                $('#closure_msgs p').html('Please fill the missing values');
                return false;
            }
        }

        if(date_of_case_closure)
        {
            values['date_of_case_closure'] = date_of_case_closure;
        }
        else
        {
            $("#closure_msgs4").css({ 'display': "block" });
            $("#closure_msgs").css({ 'display': "block" });
            $('#closure_msgs p').html('Please fill the missing values');
            return false;
        }

        values['case_closure_notes'] = case_closure_notes;

        $.ajax({
                    url: '{% url 'save_closure' %}',
                    dataType: 'json',
                    method: 'POST',
                    data: values,
                    success: function(result)
                    {
                        $.each(result, function(i, val) {
                            /*
                            var closure_status = val.closure_status;
                            var case_status = val.case_status;

                            if(closure_status == 'CLOSED')
                            {
                                crudMsg = 'Case Already Closed!';
                            }
                            **/

                            crudMsg = val.closure_msg;
                        });

                        $("#ce_msgs").css({ 'display': "block" }); 
                        $('#ce_msgs p').html(crudMsg); 

                        // $('#case_status').val('');
                        $('#case_outcome').val('');
                        $('#transfered_to').multiselect('clearSelection');
                        $('#transfered_to').multiselect('refresh');
                        $('#case_closure_notes').val(''); 
                        $('#date_of_case_closure').val(''); 

                        // hide/reset OtherOutcome
                        $("#div_intervention").css({ 'display': "none" });
                        $("#case_closure_case").multiselect("clearSelection");
                        $("#case_closure_case").multiselect("refresh");
                        $("#intervention").multiselect("clearSelection");
                        $("#intervention").multiselect("refresh");
                        $('#intervention_list').val(''); 
                        $('#interventions_manager_table').find("tr:gt(2)").remove();

                        //close residential-placement-dialog
                        $('#close-case-dialog').modal('hide');
                        $("#closure_msgs").css({ 'display': "none" }); 

                        /* Reload active/inactive Status */
                        $('#case_status_msg').load(document.URL +  ' #case_status_msg');

                        /* Reload CaseEvents */
                        LoadCaseEvents();

                        ResetEventsDialog('Closure');
                    },
                    error: function(e)
                    {
                        console.log(e)
                    }
                });
    }
    else
    {
        $("#closure_msgs2").css({ 'display': "block" });
        $("#closure_msgs").css({ 'display': "block" });
        $('#closure_msgs p').html('Please fill the missing values');
        return false;
    }
}

function fnViewClosure(case_event_id)
{
    var event_id = case_event_id.trim();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':event_id
    };

    // case_event_id
    $('#case_event_id_closure').val(event_id);

    $.ajax({
        url: '{% url 'view_closure' %}',
        dataType: 'json',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $('#close-case-dialog').modal('show');
            $("#btn_save_closure").text('Update');

            // clear rows
            $('#interventions_manager_table').find("tr:gt(1)").remove();

            $.each(result, function(i, val) 
            {
                var closure_outcome = val.closure_outcome;
                var transfer_to = val.transfer_to;
                var case_closure_notes = val.case_closure_notes;
                var date_of_event = val.date_of_event;
                var case_event_id = val.case_event_id;
                var resultsets = val.resultsets;

                $.each(resultsets, function(i, resultset)
                {
                    svc_results = resultset.jsonSvcsData;
                    case_category = resultset.case_category; 
                    case_category_id = resultset.case_category_id;                    
                    
                    $.each(svc_results, function(i, svc_result)
                    {
                        // Interventions json data
                        var rowIndex = i;
                        var pk = svc_result.pk;
                        var intervention = svc_result.service_provided;
                        var intervention_id = svc_result.service_provided_id;
                        var btnRemove = 'btnRemove' + i;
                        var id_inputElements = 'id_inputElements' + i;

                        // Add some text to the new cells:
                        var hcase_category = "<input id='hcase_category' type='hidden' value='"+case_category_id+"'>";
                        var hintervention = "<input id='hintervention' type='hidden' value='"+intervention_id+"'>";
                        var hintervention_status= "<input id='hintervention_status' type='hidden' value='exist'>";

                        var table_row = '<tr id=' + id_inputElements + '><td><h6>#</h6></td>' + 
                        '<td><h6>' + case_category + '</h6>' + hcase_category + '</td>' + 
                        '<td><h6>' + intervention + '</h6>' + hintervention + hintervention_status + '</td>' + 
                        '<td><button id=' + btnRemove + ' type="button" class="btn btn-sm btn-link m-r-5"' +
                        ' onClick="fnDeleteEncounter(\''+ case_event_id +'\',\''+ pk +'\',\''+ id_inputElements +'\')">Remove </b></button></td></tr>';

                        // Append each result to  row
                        $('#interventions_manager_table > tbody:last-child').append(table_row);
                    });
                });
                

                $('#case_outcome').val(closure_outcome);
                $("#case_outcome").trigger("change");
                $('#transfered_to').val(transfer_to); 
                $("#transfered_to").multiselect("refresh");
                $('#case_closure_notes').val(case_closure_notes);
                $('#date_of_case_closure').val(date_of_event);
            });
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    }); 

}

function fnUpdateClosure()
{
    var crudMsg = 'Case Closure Updated Successfully.';
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    // var case_status = $('#case_status').val();
    var case_outcome = $('#case_outcome').val(); 
    var transfered_to = $('#transfered_to').val(); 
    var intervention_list = $('#intervention_list').val(); 
    var case_closure_notes = $('#case_closure_notes').val(); 
    var date_of_case_closure = $('#date_of_case_closure').val();
    var case_event_id = $('#case_event_id_closure').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id,
                    'case_event_id': case_event_id
                 };
    var interventions = $('#interventions_manager_table tr').length;

    // alert('interventions length - ' + interventions)

    if(case_outcome)
    {
        values['case_outcome'] = case_outcome;
        if(case_outcome == 'COTR')
        {
            if(transfered_to)
            {
                values['transfered_to'] = transfered_to;
            }
            else
            {
                $("#closure_msgs3").css({ 'display': "block" });
                $("#closure_msgs").css({ 'display': "block" });
                $('#closure_msgs p').html('Please fill the missing values');
                return false;
            }
        }

        if(case_outcome == 'COOT')
        {
            if((intervention_list) || (interventions >=3))
            {
                values['intervention_list'] = intervention_list.toString();
            }
            else
            {
                $("#closure_msgs6").css({ 'display': "block" });
                $("#closure_msgs").css({ 'display': "block" });
                $('#closure_msgs p').html('Please fill the missing values');
                return false;
            }
        }

        if(date_of_case_closure)
        {
            values['date_of_case_closure'] = date_of_case_closure;
        }
        else
        {
            $("#closure_msgs4").css({ 'display': "block" });
            $("#closure_msgs").css({ 'display': "block" });
            $('#closure_msgs p').html('Please fill the missing values');
            return false;
        }

        values['case_closure_notes'] = case_closure_notes;

        $.ajax({
                    url: '{% url 'edit_closure' %}',
                    dataType: 'json',
                    method: 'POST',
                    data: values,
                    success: function(result)
                    {
                        $.each(result, function(i, val) {
                            crudMsg = val.closure_msg;
                        });

                        $("#ce_msgs").css({ 'display': "block" }); 
                        $('#ce_msgs p').html(crudMsg); 

                        // $('#case_status').val('');
                        $('#case_outcome').val('');
                        $('#transfered_to').multiselect('clearSelection');
                        $('#transfered_to').multiselect('refresh');
                        $('#case_closure_notes').val(''); 
                        $('#date_of_case_closure').val(''); 

                        // hide/reset OtherOutcome
                        $("#div_intervention").css({ 'display': "none" });
                        $("#case_closure_case").multiselect("clearSelection");
                        $("#case_closure_case").multiselect("refresh");
                        $("#intervention").multiselect("clearSelection");
                        $("#intervention").multiselect("refresh");
                        $('#intervention_list').val(''); 
                        $('#interventions_manager_table').find("tr:gt(2)").remove();

                        //close residential-placement-dialog
                        $('#close-case-dialog').modal('hide');
                        $("#closure_msgs").css({ 'display': "none" }); 

                        /* Reload active/inactive Status */
                        $('#case_status_msg').load(document.URL +  ' #case_status_msg');

                        /* Reload CaseEvents */
                        LoadCaseEvents();

                        ResetEventsDialog('Closure');
                    },
                    error: function(e)
                    {
                        console.log(e)
                    }
                });
    }
    else
    {
        $("#closure_msgs2").css({ 'display': "block" });
        $("#closure_msgs").css({ 'display': "block" });
        $('#closure_msgs p').html('Please fill the missing values');
        return false;
    }   
}

function fnDeleteClosure(case_event_id)
{
    var crudMsg = 'Case Closure Deleted Successfully.';
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id,
                    'case_event_id': case_event_id
                 };

    $.ajax({
                url: '{% url 'delete_closure' %}',
                dataType: 'text',
                method: 'POST',
                data: values,
                success: function(result)
                {

                    $("#ce_msgs").css({ 'display': "block" }); 
                    $('#ce_msgs p').html(crudMsg); 

                    /* Reload active/inactive Status */
                    $('#case_status_msg').load(document.URL +  ' #case_status_msg');

                    /* Reload CaseEvents */
                    LoadCaseEvents();
                },
                error: function(e)
                {
                    console.log(e)
                }
            });
}

function fnSaveCourtSession(){
    var operation_mode = $('#operation_mode').val(); 
    if(operation_mode == 'EDIT')
    { 
        fnUpdateCourtSession();
        return false;
    }

    var crudMsg = 'Court Session Saved Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id
                 };
    // action='COT'; 
    var court_session_case = $('#court_session_case').val();
    var date_of_court_event = $('#date_of_court_event').val();
    var court_session_type = $('#court_session_type').val();
    var court_outcome = $('#court_outcome').val();
    var next_hearing_date = $('#next_hearing_date').val();
    var next_mention_date = $('#next_mention_date').val();
    var plea_taken = $('#plea_taken').val();
    var application_outcome = $('#application_outcome').val();
    var court_order = $('#court_order').val();
    var court_notes = $('#court_notes').val();

    // values['action'] = action;
    values['court_notes'] = court_notes;

    if(court_session_case)
    {
        values['court_session_case'] = court_session_case;
    }
    else
    {
        $("#court_msgs0").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }

    if(date_of_court_event)
    {
        values['date_of_court_event'] = date_of_court_event;
    }
    else
    {
        $("#court_msgs1").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }

    if(court_session_type)
    {
        values['court_session_type'] = court_session_type;

        if(court_session_type == 'STHR')
        {
            if(court_outcome)
            {
                values['court_outcome'] = court_outcome;
                if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
                {
                    if(court_order)
                    {
                        values['court_order'] = court_order.toString();
                    }
                    else
                    {
                        $("#court_msgs6").css({ 'display': "block" });
                        $("#court_msgs").css({ 'display': "block" }); 
                        $('#court_msgs p').html('Please fill the missing values');
                        return false;
                    }  
                }  
                if(court_outcome == 'CADJ')
                {
                    if(next_hearing_date)
                    {
                        values['next_hearing_date'] = next_hearing_date;
                    }
                    else
                    {
                        $("#court_msgs5").css({ 'display': "block" });
                        $("#court_msgs").css({ 'display': "block" }); 
                        $('#court_msgs p').html('Please fill the missing values');
                        return false;
                    }
                }                    
            }
            else
            {
                $("#court_msgs4").css({ 'display': "block" });
                $("#court_msgs").css({ 'display': "block" }); 
                $('#court_msgs p').html('Please fill the missing values');
                return false;
            } 
        }
        if(court_session_type == 'STMN'||court_session_type == 'STPL'||court_session_type == 'STAP')
        {
            if(court_session_type=='STMN')
            {
                if(next_mention_date)
                {
                    values['next_mention_date'] = next_mention_date;
                }
                else
                {
                    $("#court_msgs3").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }

            if(court_session_type=='STPL')
            {
                if(next_mention_date)
                {
                    values['next_mention_date'] = next_mention_date;
                }
                else
                {
                    $("#court_msgs3").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }    

                if(plea_taken)
                {
                    values['plea_taken'] = plea_taken;
                }
                else
                {
                    $("#court_msgs8").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }

            if(court_session_type=='STAP')
            {
                if(application_outcome)
                {
                    values['application_outcome'] = application_outcome;

                    if(application_outcome == 'APGR')
                    {
                        if(court_outcome)
                        {
                            values['court_outcome'] = court_outcome;
                            if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
                            {
                                if(court_order)
                                {
                                    values['court_order'] = court_order.toString();
                                }
                                else
                                {
                                    $("#court_msgs6").css({ 'display': "block" });
                                    $("#court_msgs").css({ 'display': "block" }); 
                                    $('#court_msgs p').html('Please fill the missing values');
                                    return false;
                                }  
                            }  
                            if(court_outcome == 'CADJ')
                            {
                                if(next_hearing_date)
                                {
                                    values['next_hearing_date'] = next_hearing_date;
                                }
                                else
                                {
                                    $("#court_msgs5").css({ 'display': "block" });
                                    $("#court_msgs").css({ 'display': "block" }); 
                                    $('#court_msgs p').html('Please fill the missing values');
                                    return false;
                                }
                            }                    
                        }
                        else
                        {
                            $("#court_msgs4").css({ 'display': "block" });
                            $("#court_msgs").css({ 'display': "block" }); 
                            $('#court_msgs p').html('Please fill the missing values');
                            return false;
                        } 
                    }
                }
                else
                {
                    $("#court_msgs9").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }            
        }
    }
    else
    {
        $("#court_msgs2").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }

    

    // Save Court
    $.ajax({
            url: '{% url 'save_court' %}',
            dataType: 'text',
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" });  
                $('#ce_msgs p').html(crudMsg);

                LoadCaseEvents();

                ResetEventsDialog('Court');

                //close courtsessions-dialog
                $('#court-sessions-dialog').modal('hide');
                $("#court_msgs").css({ 'display': "none" });
            },
            error: function(xhr, status, error)
            {
                console.log(error)
            }
        });
}

function fnViewCourtSession(case_event_id){
    var event_id = case_event_id.trim();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':event_id
    };

    // case_event_id
    $('#case_event_id_court').val(event_id);

    $.ajax({
        url: '{% url 'view_court' %}',
        dataType: 'json',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $('#court-sessions-dialog').modal('show');
            $("#btn_save_court").text('Update');

            $.each(result, function(i, val) {
                var date_of_court_event = val.date_of_event;
                var court_outcome = val.court_outcome;
                var court_session_type = val.court_session_type;
                var date_of_court_event = val.date_of_event;
                var next_hearing_date = val.next_hearing_date;
                var next_mention_date = val.next_mention_date;
                var plea_taken = val.plea_taken;
                var application_outcome = val.application_outcome
                var court_notes = val.case_event_notes;
                var court_order = ((val.ovc_court_orders).toString()).split(",");
                var case_category_id = ((val.ovc_category_ids).toString()).split(",");

                // LoadData 
                $('#court_session_case').val(case_category_id); 
                $("#court_session_case").multiselect("refresh");
                $('#court_session_type').val(court_session_type)
                $('#court_session_type').multiselect('refresh')                
                $('#date_of_court_event').val(date_of_court_event);

                if(court_session_type == 'STHR') {
                    $('#div_court_outcome').css({'display': 'block'})
                    $('#court_outcome').val(court_outcome)
                    $('#court_outcome').multiselect('refresh')

                    if(court_outcome == 'CADJ') {
                        $('#div_next_hearing_date').css({'display': 'block'})
                        $('#next_hearing_date').val(next_hearing_date)
                    }
                    if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT') {
                        $('#div_court_order').css({'display': 'block'})
                        $('#court_order').val(court_order)
                        $('#court_order').multiselect('refresh')
                        displayVals('court_order');
                    }
                }  

                if(court_session_type == 'STMN'){
                    $('#div_next_mention_date').css({'display': 'block'})
                    $('#next_mention_date').val(next_mention_date)
                } 

                if(court_session_type == 'STPL'){
                    $('#div_plea_taken').css({'display': 'block'})
                    $('#plea_taken').val(plea_taken)

                    $('#div_next_mention_date').css({'display': 'block'})
                    $('#next_mention_date').val(next_mention_date)
                } 

                if(court_session_type == 'STAP'){
                    $('#div_application_outcome').css({'display': 'block'})
                    $('#application_outcome').val(application_outcome)

                    if(application_outcome=='APGR')
                    {
                        $('#div_court_outcome').css({'display': 'block'})
                        $('#court_outcome').val(court_outcome )
                        $('#court_outcome').multiselect('refresh')
                    }                      

                    if(court_outcome == 'CADJ') {
                        $('#div_next_hearing_date').css({'display': 'block'})
                        $('#next_hearing_date').val(next_hearing_date)
                    }
                    if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
                    {
                        $('#div_court_order').css({'display': 'block'})
                        $('#court_order').val(court_order)
                        $('#court_order').multiselect('refresh')
                        displayVals('court_order');
                    }
                } 

                $('#court_notes').val(court_notes);
            });
    },
    error: function(xhr, status, error)
    {
        alert(error);
    }
    });  
}

function fnUpdateCourtSession(){
    var crudMsg = 'Court Session Updated Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var case_event_id = $('#case_event_id_court').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id,
                    'case_event_id': case_event_id
                 };
    // action='COT'; 
    var court_session_case = $('#court_session_case').val();
    var date_of_court_event = $('#date_of_court_event').val();
    var court_session_type = $('#court_session_type').val();
    var court_outcome = $('#court_outcome').val();
    var next_hearing_date = $('#next_hearing_date').val();
    var next_mention_date = $('#next_mention_date').val();
    var plea_taken = $('#plea_taken').val();
    var application_outcome = $('#application_outcome').val();
    var court_order = $('#court_order').val();
    var court_notes = $('#court_notes').val();

    // values['action'] = action;
    values['court_notes'] = court_notes;

    if(court_session_case)
    {
        values['court_session_case'] = court_session_case;
    }
    else
    {
        $("#court_msgs0").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }

    if(date_of_court_event)
    {
        values['date_of_court_event'] = date_of_court_event;
    }
    else
    {
        $("#court_msgs1").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }

    if(court_session_type)
    {
        values['court_session_type'] = court_session_type;

        if(court_session_type == 'STHR')
        {
            if(court_outcome)
            {
                values['court_outcome'] = court_outcome;
                if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
                {
                    if(court_order)
                    {
                        values['court_order'] = court_order.toString();
                    }
                    else
                    {
                        $("#court_msgs6").css({ 'display': "block" });
                        $("#court_msgs").css({ 'display': "block" }); 
                        $('#court_msgs p').html('Please fill the missing values');
                        return false;
                    }  
                }  
                if(court_outcome == 'CADJ')
                {
                    if(next_hearing_date)
                    {
                        values['next_hearing_date'] = next_hearing_date;
                    }
                    else
                    {
                        $("#court_msgs5").css({ 'display': "block" });
                        $("#court_msgs").css({ 'display': "block" }); 
                        $('#court_msgs p').html('Please fill the missing values');
                        return false;
                    }
                }                    
            }
            else
            {
                $("#court_msgs4").css({ 'display': "block" });
                $("#court_msgs").css({ 'display': "block" }); 
                $('#court_msgs p').html('Please fill the missing values');
                return false;
            } 
        }
        if(court_session_type == 'STMN'||court_session_type == 'STPL'||court_session_type == 'STAP')
        {
            if(court_session_type=='STMN')
            {
                if(next_mention_date)
                {
                    values['next_mention_date'] = next_mention_date;
                }
                else
                {
                    $("#court_msgs3").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }

            if(court_session_type=='STPL')
            {
                if(next_mention_date)
                {
                    values['next_mention_date'] = next_mention_date;
                }
                else
                {
                    $("#court_msgs3").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }    

                if(plea_taken)
                {
                    values['plea_taken'] = plea_taken;
                }
                else
                {
                    $("#court_msgs8").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }

            if(court_session_type=='STAP')
            {
                if(application_outcome)
                {
                    values['application_outcome'] = application_outcome;

                    if(application_outcome == 'APGR')
                    {
                        if(court_outcome)
                        {
                            values['court_outcome'] = court_outcome;
                            if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
                            {
                                if(court_order)
                                {
                                    values['court_order'] = court_order.toString();
                                }
                                else
                                {
                                    $("#court_msgs6").css({ 'display': "block" });
                                    $("#court_msgs").css({ 'display': "block" }); 
                                    $('#court_msgs p').html('Please fill the missing values');
                                    return false;
                                }  
                            }  
                            if(court_outcome == 'CADJ')
                            {
                                if(next_hearing_date)
                                {
                                    values['next_hearing_date'] = next_hearing_date;
                                }
                                else
                                {
                                    $("#court_msgs5").css({ 'display': "block" });
                                    $("#court_msgs").css({ 'display': "block" }); 
                                    $('#court_msgs p').html('Please fill the missing values');
                                    return false;
                                }
                            }                    
                        }
                        else
                        {
                            $("#court_msgs4").css({ 'display': "block" });
                            $("#court_msgs").css({ 'display': "block" }); 
                            $('#court_msgs p').html('Please fill the missing values');
                            return false;
                        } 
                    }
                }
                else
                {
                    $("#court_msgs9").css({ 'display': "block" });
                    $("#court_msgs").css({ 'display': "block" }); 
                    $('#court_msgs p').html('Please fill the missing values');
                    return false;
                }                    
            }            
        }
    }
    else
    {
        $("#court_msgs2").css({ 'display': "block" });
        $("#court_msgs").css({ 'display': "block" }); 
        $('#court_msgs p').html('Please fill the missing values');
        return false;
    }
    

    // Update Court
    $.ajax({
            url: '{% url 'edit_court' %}',
            dataType: 'text',
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" });  
                $('#ce_msgs p').html(crudMsg);

                LoadCaseEvents();

                ResetEventsDialog('Court');

                //close courtsessions-dialog
                $('#court-sessions-dialog').modal('hide');
                $("#court_msgs").css({ 'display': "none" });

                $("#btn_save_court").text('Save');
                $("#operation_mode").val('');
            },
            error: function(xhr, status, error)
            {
                console.log(error)
            }
        });    
}

function fnDeleteCourtSession(case_event_id){
    var crudMsg = 'Court Session Deleted Successfully!';
    var services_array = new Array();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':case_event_id
    };

    $.ajax({
        url: '{% url 'delete_court' %}',
        dataType: 'text',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $("#ce_msgs").css({ 'display': "block" }); 
            $('#ce_msgs p').html(crudMsg);

            //close delete-dialog
            $('#delete-dialog').modal('hide');

            LoadCaseEvents();
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    });
}

function fnSaveEncounter(){
    var operation_mode = $('#operation_mode').val(); 
    if(operation_mode == 'EDIT')
    { 
        fnUpdateEncounter();
        return false;
    }

    var crudMsg = 'Encounters/Services Saved Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id
                 };
    var case_category_id = $('#service_provided_case').val();
    var service_provided_list = $('#service_provided_list').val();
    var encounter_notes = $('#encounter_notes').val();

    //validation
    if(case_category_id)
    {
        if(service_provided_list)
        {
            values['case_category_id'] = case_category_id;
            values['service_provided_list'] = service_provided_list;
            values['encounter_notes'] = encounter_notes;

             $.ajax({
                url: '{% url 'save_encounter' %}',
                dataType: 'text',
                method: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: values,
                success: function(data)
                {
                    $("#ce_msgs").css({ 'display': "block" });
                    $('#ce_msgs p').html(crudMsg);

                    LoadCaseEvents();

                    ResetEventsDialog('Services');

                    //close services-dialog
                    $('#services-dialog').modal('hide');
                },
                error: function(e)
                {
                    console.log(e);
                }
            });   
        }
        else
        {
            $("#encounters_msgs1").css({ 'display': "block" }); 
            $("#encounters_msgs").css({ 'display': "block" }); 
            $('#encounters_msgs p').html('Please fill the missing values');
        }
    }
    else
    {
        $("#encounters_msgs0").css({ 'display': "block" }); 
        $("#encounters_msgs").css({ 'display': "block" }); 
        $('#encounters_msgs p').html('Please fill the missing values');
    }
}

function fnViewEncounter(case_event_id){ 
    var EncountersData = new Array();
    var event_id = case_event_id.trim();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':event_id
    };

    // case_event_id
    $('#case_event_id_svc').val(event_id);

    $.ajax({
            url: '{% url 'view_encounter' %}',
            dataType: 'json',
            method: 'POST',
            data: values,
            success: function(result)
            { 
                // show dialog
                $('#services-dialog').modal('show');

                // clear rows
                $('#services_manager_table').find("tr:gt(1)").remove();
                
                $('#btn_save_encounter').text('Update');

                // Populate Grid
                $.each(result, function(i, val) {
                    var case_event_id = val.case_event_id
                    var date_of_event = val.date_of_event;
                    var encounter_notes = val.case_event_notes;
                    var case_category = val.case_category;
                    var resultsets = val.resultsets;

                    $.each(resultsets, function(i, resultset)
                    {
                        $.each(resultset, function(i, result)
                        { 
                            // Remove pre-exisiting rows 
                            $('#id_inputElements' + i + '').remove();

                            var rowIndex = i;
                            var pk = result.pk;
                            var service_provided = result.service_provided;
                            var service_provided_id = result.service_provided_id;
                            var date_of_encounter_event = result.date_of_encounter_event;
                            var service_provider = result.service_provider;
                            var service_provider_id = result.service_provider_id;
                            var place_of_service = result.place_of_service;
                            var service_grouping_id = result.service_grouping_id;
                            var btnRemove = 'btnRemove' + i;
                            var id_inputElements = 'id_inputElements' + i;

                            // Hidden Inputs
                            var hservice_provided = "<input id='hservice_provided' type='hidden' value='"+service_provided_id+"'>"
                            var hservice_provider = "<input id='hservice_provider'  type='hidden'  value='"+service_provider_id+"'>"
                            var hservice_status= "<input id='hservice_status'  type='hidden' value='exist'>"


                            var table_row = '<tr id=' + id_inputElements + '><td><h6>' + (i+1) + '</h6></td>' + 
                            '<td><h6>' + service_provided + '</h6>' +hservice_provided+ '</td><td><h6>' + date_of_encounter_event + '</h6></td>' + 
                            '<td><h6>' + service_provider + '</h6>' +hservice_provider+ '</td><td><h6>' + place_of_service + '</h6>' + hservice_status + '</td>' + 
                            '<td><button id=' + btnRemove + ' type="button" class="btn btn-sm btn-link m-r-5"' +
                            ' onClick="fnDeleteEncounter(\''+ case_event_id +'\',\''+ pk +'\',\''+ id_inputElements +'\')">Remove </b></button></td></tr>'

                            // Append each result to  row
                            $('#services_manager_table > tbody:last-child').append(table_row);

                        });
                    });
                    $('#encounter_notes').val(encounter_notes);
                    $('#service_provided_case').val(case_category); 
                    $('#service_provided_case').multiselect('refresh'); 
                });
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
}

function fnUpdateEncounter(){
    var crudMsg = 'Encounters/Services Session Updated Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var case_event_id = $('#case_event_id_svc').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id,
                    'case_event_id': case_event_id
                 };
    var case_category_id = $('#service_provided_case').val();
    var service_provided_list = $('#service_provided_list').val();
    var encounter_notes = $('#encounter_notes').val();
    var services = $('#services_manager_table tr').length;

    //validation
    if(case_category_id)
    {
        if((service_provided_list) || (services >=3))
        {
            values['case_category_id'] = case_category_id;
            values['service_provided_list'] = service_provided_list;
            values['encounter_notes'] = encounter_notes;

             $.ajax({
                url: '{% url 'edit_encounter' %}',
                dataType: 'text',
                method: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: values,
                success: function(data)
                {
                    $("#ce_msgs").css({ 'display': "block" });
                    $('#ce_msgs p').html(crudMsg);

                    LoadCaseEvents();

                    ResetEventsDialog('Services');

                    //close services-dialog
                    $('#services-dialog').modal('hide');
                },
                error: function(e)
                {
                    $("#ce_msgs").css({ 'display': "block" });
                    $('#ce_msgs p').html(e);
                }
            });   
        }
        else
        {
            $("#encounters_msgs1").css({ 'display': "block" }); 
            $("#encounters_msgs").css({ 'display': "block" }); 
            $('#encounters_msgs p').html('Please fill the missing values');
        }
    }
    else
    {
        $("#encounters_msgs0").css({ 'display': "block" }); 
        $("#encounters_msgs").css({ 'display': "block" }); 
        $('#encounters_msgs p').html('Please fill the missing values');
    }
}

function fnDeleteEncounter(case_event_id, service_id, row){
    var crudMsg = 'Encounter/Services Deleted Successfully!';
    var services_array = new Array();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'case_event_id':case_event_id,
        'service_id': service_id
    };

    $.ajax({
        url: '{% url 'delete_encounter' %}',
        dataType: 'text',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $("#ce_msgs").css({ 'display': "block" }); 
            $('#ce_msgs p').html(crudMsg);

            if(service_id){
                $("#" + row).remove();
            }

            LoadCaseEvents();
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    });
    
}

function fnSaveSummons(){
    var operation_mode = $('#operation_mode').val();
    if(operation_mode == 'EDIT')
    { 
        fnUpdateSummons();
        return false;
    }

    var crudMsg = 'Summon Saved Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var values = {
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id
                 };

    var honoured = $('#honoured').val();
    var honoured_date = $('#honoured_date').val();
    var summon_date = $('#summon_date').val();
    // var visit_date = $('#visit_date').val();
    var summon_note = $('#summon_note').val();
    
    values['summon_note'] = summon_note;

    if(honoured_date)
    {
        values['honoured_date'] = honoured_date;
    }
    else
    {
        $("#summons_msgs2").css({ 'display': "block" });
        $("#summon_msgs").css({ 'display': "block" });
        $('#summon_msgs p').html('Please fill the missing values');
        return false;
    }

    if(honoured)
    {
        values['honoured'] = honoured;
        if(honoured=='AYES')
        {
            values['summon_date'] = summon_date;            
        }
        if(honoured=='ANNO')
        {
            var summon_count = parseInt($('#summon_count').html());
            if(summon_count >= 2)
            {
                values['summon_date'] = null;
            }
            else
            {
                if(summon_date)
                {
                    values['summon_date'] = summon_date;
                }
                else
                {
                    $("#summons_msgs3").css({ 'display': "block" });
                    $("#summon_msgs").css({ 'display': "block" });
                    $('#summon_msgs p').html('Please fill the missing values');
                    return false;
                }
            }            
        }
    }
    else
    {
        $("#summons_msgs1").css({ 'display': "block" });
        $("#summon_msgs").css({ 'display': "block" });
        $('#summon_msgs p').html('Please fill the missing values');
        return false;
    } 

    // Save Summons
    $.ajax({
            url: '{% url 'save_summon' %}',
            dataType: 'text',
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" });
                $('#ce_msgs p').html(crudMsg);

                LoadCaseEvents();

                ResetEventsDialog('Summon');

                //close courtsessions-dialog
                $('#summons-dialog').modal('hide');
                $("#summon_msgs").css({ 'display': "none" });
            },
            error: function(xhr, status, error)
            {
                console.log(error)
            }
        });
      
}

function fnViewSummon(case_event_id){
    var event_id = case_event_id.trim();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':event_id
    };

    // case_event_id
    $('#case_event_id_summon').val(event_id);

    $.ajax({
            url: '{% url 'view_summon' %}',
            dataType: 'json',
            method: 'POST',
            data: values,
            success: function(result)
            { 
                // show dialog
                $('#summons-dialog').modal('show');

                $('#btn_save_summon').text('Update');

                // Extract JSON
                $.each(result, function(i, val) {
                    var honoured = val.honoured;
                    var date_of_event = val.date_of_event;
                    var summon_date =val.summon_date;
                    var summon_note = val.summon_note;
                    var visit_date = val.visit_date;
                    var case_event_id = val.case_event_id;

                    $('#honoured').val(honoured);
                    // $('#honoured').trigger('change');
                    // $('#visit_date').val(visit_date);
                    $('#honoured_date').val(date_of_event);
                    if(honoured=='ANNO'){ 
                        if(summon_date)
                        {  
                            $('#div_summon_date').css({'display': 'block'});                          
                            $('#summon_date').val(summon_date);                             
                        }
                        else
                        {
                            $('#div_summon_date').css({'display': 'none'});                          
                            $('#summon_date').val('');                             
                        }
                    }
                    $('#summon_note').val(summon_note);
                });
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
}

function fnUpdateSummons(case_event_id){
    var crudMsg = 'Summons Updated Successfully.';
    var data = new Array();
    var csrftoken = $.cookie('csrftoken');
    var case_id = $('#case_id').val();
    var case_event_id = $('#case_event_id_summon').val();
    var values = {  
                    'csrfmiddlewaretoken': csrftoken,
                    'case_id':case_id,
                    'case_event_id': case_event_id
                 };

    var honoured = $('#honoured').val();
    var honoured_date = $('#honoured_date').val();
    var summon_date = $('#summon_date').val();
    // var visit_date = $('#visit_date').val();
    var summon_note = $('#summon_note').val();
    
    values['summon_note'] = summon_note;

    if(honoured_date)
    {
        values['honoured_date'] = honoured_date;
    }
    else
    {
        $("#summons_msgs2").css({ 'display': "block" });
        $("#summon_msgs").css({ 'display': "block" });
        $('#summon_msgs p').html('Please fill the missing values');
        return false;
    }

    if(honoured)
    {
        values['honoured'] = honoured;
        if(honoured=='AYES')
        {
            values['summon_date'] = summon_date;            
        }
        if(honoured=='ANNO')
        {
            var summon_count = parseInt($('#summon_count').html());
            if(summon_count >= 2)
            {
                values['summon_date'] = null;
            }
            else
            {
                if(summon_date)
                {
                    values['summon_date'] = summon_date;
                }
                else
                {
                    $("#summons_msgs3").css({ 'display': "block" });
                    $("#summon_msgs").css({ 'display': "block" });
                    $('#summon_msgs p').html('Please fill the missing values');
                    return false;
                }
            }            
        }
    }
    else
    {
        $("#summons_msgs1").css({ 'display': "block" });
        $("#summon_msgs").css({ 'display': "block" });
        $('#summon_msgs p').html('Please fill the missing values');
        return false;
    }     


    // Update Summons
    $.ajax({
            url: '{% url 'edit_summon' %}',
            dataType: 'text',
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: values,
            success: function(result)
            {
                $("#ce_msgs").css({ 'display': "block" });
                $('#ce_msgs p').html(crudMsg);

                LoadCaseEvents();

                ResetEventsDialog('Summon');

                //close courtsessions-dialog
                $('#summons-dialog').modal('hide');
                $("#summon_msgs").css({ 'display': "none" });
            },
            error: function(xhr, status, error)
            {
                console.log(error)
            }
        });
}

function fnDeleteSummon(case_event_id){
    var crudMsg = 'Summon Deleted Successfully!';
    var services_array = new Array();
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'event_id':case_event_id
    };

    $.ajax({
        url: '{% url 'delete_summon' %}',
        dataType: 'text',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $("#ce_msgs").css({ 'display': "block" }); 
            $('#ce_msgs p').html(crudMsg);

            // Load Grid
            LoadCaseEvents();
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    });
}

function fnDeleteReferral(referral_id){
    var crudMsg = 'Referral Deleted Successfully!';
    var csrftoken = $.cookie('csrftoken');
    var values = {  
        'csrfmiddlewaretoken': csrftoken,
        'referral_id':referral_id
    };

    $.ajax({
        url: '{% url 'delete_referral' %}',
        dataType: 'text',
        method: 'POST',
        data: values,
        success: function(result)
        {
            $("#ce_msgs").css({ 'display': "block" }); 
            $('#ce_msgs p').html(crudMsg);

            // Reset New Referrals Table
            $("#new_refferals_table").find("tr:gt(1)").remove();

            // Load Grid
            LoadCaseEvents();

            // Load Referrals
            LoadReferrals();
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    });
}
</script>
<script>
$(document).ready(function() 
{
    /* 
    Load CaseEvents From Database
    */
    LoadCaseEvents();

    /* 
    Load Referrals From Database
    */
    LoadReferrals();

    /* 
     Make a Call To getJsonObject001() To Get Case Categories to load to Multiselects;
     These will be picked when adding Encounters/Court/Placements
    */
    getJsonObject001();

    // workforce_member autocomplete
    $( "#workforce_member_svc,#workforce_member_court,#workforce_member_plcmnt" ).autocomplete({
        source: function( request, response ) {
        $.ajax({
          url: "{% url 'registry' %}",
          dataType: "json",
          data: {q: request.term, id: 0},
          success: function( data ) {
            response( data );
          }
        });
      },
      minLength: 4,
      open: function() {
        $( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
      },
      close: function() {
        $( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
      }
    });

    //multi selects
    $('#refferal_case, #service_provided_case, #court_session_case, #court_session_type, #service_provided, #court_order, #court_outcome, #refferals_made, #service_provider, #refferals_actor, #refferals_actor_specify, #transfered_to, #intervention, #case_closure_case').multiselect({
        selectAllValue: 'multiselect-all',
        includeSelectAllOption: true,
        enableCaseInsensitiveFiltering: true,
        numberDisplayed: 1,
        maxHeight: 300,
        buttonWidth: '100%',
        buttonClass: 'btn btn-white'
    }); 

    //bootstrap table - #case_events_data_table
    $('#case_events_data_table').bootstrapTable(
    { 
        toggle: 'table', 
        search: 'true',
        locale: 'en-US',
        pagination: 'true',
        pageNumber: 1,
        pageSize: 10,
        //showRefresh: true,
        showToggle: true,
        //showColumns: true,
        singleSelect: true,
        clickToSelect:true,
        maintainSelected: true, 

        onClickRow: function (row, $element)
        {
            var case_event_id = row[0].trim();
            var case_event_type = row[1].trim();
            $('#case_event_id').val(case_event_id);
            $('#case_event_type').val(case_event_type);
        }
    }); 

    /**    

    // Bootstrap Table
    $('#old_refferals_table').bootstrapTable(
    { 
        toggle: 'table', 
        search: 'true',
        locale: 'en-US',
        pagination: 'true',
        pageNumber: 1,
        pageSize: 10,
        //showRefresh: true,
        showToggle: true,
        //showColumns: true,
        singleSelect: true,
        clickToSelect:true,
        maintainSelected: true
    });
    **/


    var court_outcome = $('#court_outcome').val();
    if(court_outcome == 'CADJ')
    {
        $('#div_court_order').css({'display': 'none'}); 
        $('#court_order').attr('data-parsley-required', 'false');
        $('#court_order').val('');
        $('#div_next_hearing_date').css({'display': 'block'}); 
    }
    else if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
    {
        $('#div_court_order').css({'display': 'block'}); 
        $('#court_order').attr('data-parsley-required', 'true');
        $('#div_next_hearing_date').css({'display': 'none'}); 
        $('#next_hearing_date').val('');
    }

    // Reconfigure next_hearing_date
    $('#next_hearing_date').datepicker('remove');
    $('#next_hearing_date').datepicker({ 
        dateFormat: 'yy-mm-dd', format: 'dd-M-yyyy',
        startDate: '+1d', startdate: '+1d', autoclose: true
    });

    $('html,body').scrollTop(0);
    //FormWizardValidation.init();
});
</script>
<script type="text/javascript">
function displayVals(value)
{
    var selections = [];
    $("#" + value + " option:selected").each(function () 
    {
       var $this = $(this);
       if ($this.length)
       {
            var selText = $this.text();
            selections.push(selText);
            //console.log(selText);
       }
    });
    $( "#sel_"+value ).html(selections.join( ", " ) );
}

function displayVals2(value)
{
    var selections = [];
    $("#" + value + " option:selected").each(function () 
    {
       var $this = $(this);
       if ($this.length)
       {
            var selText = $this.text();
            selections.push(selText);
            //console.log(selText);
       }
    });
    $( "#sel_"+value ).html(selections.join( ", <br>" ) );
}

function displayVals3(value)
{
    var selections = [];
    $("#" + value + " option:selected").each(function () 
    {
       var $this = $(this);
       if ($this.length)
       {
            var selText = $this.text();
            selections.push(selText);
            //console.log(selText);
       }
    });
    
    return selections.join( ", <br>" );
}

// Summons
$("#honoured").change(function(event) 
{ 
    var honoured = $('#honoured').val();
    if(honoured == 'AYES')
    {
        $('#div_summon_date').css({'display': 'none'});
        // $('#div_honoured_date').css({'display': 'block'});       
    }
    else if(honoured == 'ANNO')
    {
        // $('#div_honoured_date').css({'display': 'none'});
        // $('#honoured_date').val('');

        var summon_count = parseInt($('#summon_count').html());
        if(summon_count >= 2)
        {
            $('#div_summon_date').css({'display': 'none'});
            $('#summon_date').val('');
        }
        else
        {
            $('#div_summon_date').css({'display': 'block'}); 

            // reconfigure date_of_next_summon
            var reported_date = $('#reported_date').datepicker('getDate');
            var new_date_case_opened = reported_date.getDate() + '/' 
                                        + (reported_date.getMonth() + 1) + '/' 
                                        + reported_date.getFullYear(); 
            $('#summon_date').datepicker('remove');
            $('#summon_date').datepicker({ 
                startDate: new_date_case_opened,
                // endDate: new_date_case_opened,
                format: 'dd-M-yyyy'
            });          
        }
    }
    else
    {
        $('#div_summon_date').css({'display': 'none'});
        $('#summon_date').val('')
    }
    $("#summons_msgs1").css({ 'display': "none" });
});

$("#honoured_date").change(function(event) 
{ 
    $("#summons_msgs2").css({ 'display': "none" });
});

$("#summon_date").change(function(event) 
{ 
    $("#summons_msgs3").css({ 'display': "none" });
});


//Services
$("#service_provided").change(function(event) 
{ 
    displayVals2("service_provided");
});
$('#service_provided').trigger('change');

$("#service_provider").change(function(event) 
{ 
    displayVals2("service_provider");
});
$('#service_provided').trigger('change');

$("#court_order").change(function(event) 
{ 
    displayVals("court_order");
});
$('#court_order').trigger('change');

//- - - - - CLEAR ERRORS - - - - //

/* Services/Encounters Dialog */
$("#service_provided_case").change(function(event) 
{ 
    $("#encounters_msgs0").css({ 'display': "none" }); 
});

// Reconfigure date_of_encounter_event
$('#date_of_encounter_event').val('');
$('#date_of_encounter_event').datepicker('remove');
$('#date_of_encounter_event').datepicker({ 
    endDate: '+0d',
    format: 'dd-M-yyyy'
});
    
$('#date_of_encounter_event').datepicker().on('change.dp', function(e) {
    $("#date_of_encounter_event_errormsg").css({ 'display': "none" });
});

$('#encounter_notes').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#encounters_msgs2").css({ 'display': "none" }); 
    }
});

$("#service_provided").change(function(event) 
{ 
    $("#service_provided_errormsg").css({ 'display': "none" }); 
});

$("#service_provider").change(function(event) 
{ 
    $("#service_provider_errormsg").css({ 'display': "none" }); 
});

$('#place_of_service').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#place_of_service_errormsg").css({ 'display': "none" }); 
    }
});

$('#service_provided_list').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#encounters_msgs2").css({ 'display': "none" }); 
    }
});

$('#workforce_member_svc').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#encounters_msgs4").css({ 'display': "none" }); 
    }
});

/* Court Sessions Dialog*/ 
$("#court_session_case").change(function(event) 
{ 
    $("#court_msgs0").css({ 'display': "none" }); 
});

$('#date_of_court_event').datepicker({ format: 'dd-M-yyyy' });
$('#date_of_court_event').datepicker().on('change.dp', function(e) {
    $("#court_msgs1").css({ 'display': "none" });
});

$("#court_session_type").change(function(event) 
{ 
    var court_session_type = $('#court_session_type').val();

    if(court_session_type == 'STMN')
    {
        // Display
        $('#div_next_mention_date').css({'display': 'block'});

        // Hide
        $('#div_plea_taken').css({'display': 'none'});
        $('#plea_taken').val('');

        $('#div_application_outcome').css({'display': 'none'});
        $('#application_outcome').val('');

        $('#div_next_hearing_date').css({'display': 'none'});
        $('#next_hearing_date').val('');

        $('#div_court_outcome').css({'display': 'none'});
        $('#court_outcome').multiselect('clearSelection');

        $('#div_court_order').css({'display': 'none'}) 
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html(''); 
    }
    
    else if(court_session_type == 'STPL')
    {
        // Display
        $('#div_next_mention_date').css({'display': 'block'});
        $('#div_plea_taken').css({'display': 'block'});

        // Hide
        $('#div_application_outcome').css({'display': 'none'});
        $('#application_outcome').val('');

        $('#div_next_hearing_date').css({'display': 'none'});
        $('#next_hearing_date').val('');

        $('#div_court_outcome').css({'display': 'none'});
        $('#court_outcome').multiselect('clearSelection');
        $('#court_outcome').multiselect('refresh');
        // $('#court_outcome').trigger('change');

        $('#div_court_order').css({'display': 'none'}) 
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html('');
    }

    else if(court_session_type == 'STAP')
    {
        // Display
        $('#div_application_outcome').css({'display': 'block'});

        // Hide
        $('#div_plea_taken').css({'display': 'none'});
        $('#plea_taken').val('');

        $('#div_next_mention_date').css({'display': 'none'});
        $('#next_mention_date').val('');

        $('#div_next_hearing_date').css({'display': 'none'});
        $('#next_hearing_date').val('');

        $('#div_court_outcome').css({'display': 'none'});
        $('#court_outcome').multiselect('clearSelection');
        //$('#court_outcome').multiselect('refresh');
        // $('#court_outcome').trigger('change');

        $('#div_court_order').css({'display': 'none'}) 
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html(''); 
    }

    else if(court_session_type == 'STHR')
    {
        // Display
        $('#div_court_outcome').css({'display': 'block'});
        $('#court_outcome').multiselect('clearSelection');
        $('#court_outcome').multiselect('refresh')
        $('#court_outcome').trigger('change');

        // Hide
        $('#div_plea_taken').css({'display': 'none'});
        $('#plea_taken').val('');

        $('#div_application_outcome').css({'display': 'none'});
        $('#application_outcome').val('');

        $('#div_next_mention_date').css({'display': 'none'});
        $('#next_mention_date').val('');

        $('#div_next_hearing_date').css({'display': 'none'});
        $('#next_hearing_date').val('');

    }

    else
    {
        // Hide All
        $('#div_plea_taken').css({'display': 'none'});
        $('#plea_taken').val('');

        $('#div_application_outcome').css({'display': 'none'});
        $('#application_outcome').val('');

        $('#div_next_mention_date').css({'display': 'none'});
        $('#next_mention_date').val('');

        $('#div_next_hearing_date').css({'display': 'none'});
        $('#next_hearing_date').val('');

        $('#div_court_outcome').css({'display': 'none'});
        $('#court_outcome').multiselect('clearSelection');
        $('#court_outcome').multiselect('refresh');
        // $('#court_outcome').trigger('change');

        $('#div_court_order').css({'display': 'none'}) 
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html('');
    }

    
    $("#court_msgs2").css({ 'display': "none" });
});

$("#application_outcome").change(function(event) 
{ 
    // if GRANTED pick Court Orders
    var application_outcome = $('#application_outcome').val();
    if(application_outcome == 'APGR')
    {
        $('#court_outcome').css({'display': 'block'});
        $('#court_outcome').multiselect('clearSelection');
        $('#court_outcome').multiselect('refresh')
        $('#court_outcome').trigger('change');
    }
    else
    {
        $('#div_court_outcome').css({'display': 'none'});
        $('#court_outcome').multiselect('clearSelection');
        $('#court_outcome').multiselect('refresh') 
        $('#court_outcome').trigger('change') ;      
    }
});

$("#court_outcome").change(function(event) 
{ 
    var court_outcome = $('#court_outcome').val();
    if(court_outcome == 'CADJ')
    {
        $('#div_court_order').css({'display': 'none'});
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html('')
        $('#div_next_hearing_date').css({'display': 'block'}); 
    }
    else if(court_outcome == 'CRUL'||court_outcome == 'CRJD'||court_outcome == 'CRCT')
    {
        $('#div_court_order').css({'display': 'block'}); 
        $('#div_next_hearing_date').css({'display': 'none'}); 
        $('#next_hearing_date').val('');
    }
    else
    {
        $('#div_court_order').css({'display': 'none'});
        $('#court_order').multiselect('clearSelection');
        $('#court_order').multiselect('refresh')
        $('#sel_court_order').html('')

        $('#div_next_hearing_date').css({'display': 'none'}); 
        $('#next_hearing_date').val('');
    }
    $("#court_msgs4").css({ 'display': "none" });
});

$('#next_hearing_date').datepicker({ format: 'dd-M-yyyy' });
$('#next_hearing_date').datepicker().on('change.dp', function(e) {
    $("#court_msgs3").css({ 'display': "none" });
});

$('#date_of_court_event').datepicker().on('change.dp', function(e) {
    var date_of_court_event = $('#date_of_court_event').datepicker('getDate');
    var new_court_event_date = (date_of_court_event.getDate() + 1) + '/' 
                                + (date_of_court_event.getMonth() + 1) + '/' 
                                + date_of_court_event.getFullYear(); 

    // Reconfigure next_mention_date
    $('#next_mention_date').val('');
    $('#next_mention_date').datepicker('remove');
    $('#next_mention_date').datepicker({ 
        startDate: new_court_event_date,
        format: 'dd-M-yyyy'
    });

    // Reconfigure next_hearing_date
    $('#next_hearing_date').val('');
    $('#next_hearing_date').datepicker('remove');
    $('#next_hearing_date').datepicker({ 
        startDate: new_court_event_date,
        format: 'dd-M-yyyy'
    });
});

$('#court_notes').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#court_msgs2").css({ 'display': "none" }); 
    }
});

$("#court_order").change(function(event) 
{ 
    $("#court_msgs3").css({ 'display': "none" }); 
});

$('#workforce_member_court').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#court_msgs4").css({ 'display': "none" }); 
    }
});

/* Manage Referrals */
$("#refferal_case").change(function(event) 
{ 
    $("#refferal_case_errormsg").css({ 'display': "none" }); 
    displayVals('refferal_case');
});

$("#refferals_actor").change(function(event) 
{ 
    $("#refferals_actor_errormsg").css({ 'display': "none" }); 
    displayVals('refferals_actor');
});

$("#refferals_actor_specify").change(function(event) 
{ 
    $("#refferals_actor_specify_errormsg").css({ 'display': "none" }); 
    displayVals('refferals_actor_specify');
});

/*
$('#refferals_actor_specify').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#refferals_actor_specify_errormsg").css({ 'display': "none" }); 
    }
});
**/

$("#refferals_made").change(function(event) 
{ 
    $("#refferals_made_errormsg").css({ 'display': "none" }); 
    displayVals('refferals_made');
});


/* Closure Dialog */
$('#date_of_case_closure').datepicker({ format: 'dd-M-yyyy' });
$('#date_of_case_closure').datepicker().on('change.dp', function(e) {
    $("#closure_msgs4").css({ 'display': "none" });
});

$('#case_closure_notes').keyup(function() {
    if($(this).val()) // get the current value of the input field    
    {
        $("#closure_msgs2").css({ 'display': "none" }); 
    }
});

$("#case_status").change(function(event) 
{ 
    $("#closure_msgs1").css({ 'display': "none" }); 
});

$("#case_outcome").change(function(event) 
{ 
    var case_outcome = $('#case_outcome').val();
    console.log('case_outcome: ' + case_outcome)
    if(case_outcome =='COTR')
    {
        $("#div_transfered_to").css({ 'display': "block" });
        $("#div_intervention").css({ 'display': "none" });
        $("#intervention").multiselect('clearSelection');
        $("#intervention").multiselect('refresh');
        $("#case_closure_case").multiselect('clearSelection');
        $("#case_closure_case").multiselect('refresh');
        $("#intervention_list").val('');
        $('#interventions_manager_table').find("tr:gt(2)").remove();
    } 
    else if(case_outcome =='COOT')
    {
        $("#div_intervention").css({ 'display': "block" });
        $("#div_transfered_to").css({ 'display': "none" });
        $("#transfered_to").multiselect('clearSelection');
        $("#transfered_to").multiselect('refresh');
    }
    else
    {
        $("#div_transfered_to").css({ 'display': "none" });
        $("#transfered_to").multiselect('clearSelection');
        $("#transfered_to").multiselect('refresh');

        $("#div_intervention").css({ 'display': "none" });
        $("#intervention").multiselect('clearSelection');
        $("#intervention").multiselect('refresh');
        $("#case_closure_case").multiselect('clearSelection');
        $("#case_closure_case").multiselect('refresh');
        $("#intervention_list").val('');
        $('#interventions_manager_table').find("tr:gt(2)").remove();
    }

    $("#closure_msgs2").css({ 'display': "none" });
    $("#closure_msgs6").css({ 'display': "none" });
});

$("#intervention").change(function(event) 
{ 
    //displayVals('intervention');
    $("#intervention_errormsg").css({ 'display': "none" }); 
});

$("#case_closure_case").change(function(event) 
{ 
    //displayVals('intervention');
    $("#case_closure_case_errormsg").css({ 'display': "none" }); 
});

// Reconfigure date_of_case_closure
$('#date_of_case_closure').val('');
$('#date_of_case_closure').datepicker('remove');
$('#date_of_case_closure').datepicker({ 
    endDate: '1d',
    format: 'dd-M-yyyy'
});

/* Mentions Dialog */
// Reconfigure next_mention_date
$('#next_mention_date').val('');
$('#next_mention_date').datepicker('remove');
$('#next_mention_date').datepicker({ 
    endDate: '-0d',
    format: 'dd-M-yyyy'
});

/* Case Status Dialog */
$('#case-status-dialog').on('shown.bs.modal', function() {
    var case_status = $('#btn_case_status').text();
      $('#span_case_status').html('This case is ' + case_status + '.');
    });

</script>
{% endblock %}
